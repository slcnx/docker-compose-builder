"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[171],{57004:function(Lt,Xe,_){_.r(Xe),_.d(Xe,{default:function(){return St}});var tt=_(26068),d=_.n(tt),rt=_(48305),j=_.n(rt),b=_(75271),q=_(26114),ot=_(15558),Me=_.n(ot),nt=_(31759),De=_.n(nt),it=_(25298),at=_.n(it),ut=_(17069),st=_.n(ut),lt=_(82092),Te=_.n(lt),ct=function(){q.kJ.registerNode("docker-container",{inherit:"rect",width:700,height:320,attrs:{body:{stroke:"#333",strokeWidth:2,fill:"transparent",strokeDasharray:"5,5",cursor:"move"},text:{fontSize:12,fill:"#333",textAnchor:"start",refX:10,refY:15}},ports:{groups:{top:{position:"top",attrs:{circle:{r:6,magnet:!0,stroke:"#31d0c6",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:6,magnet:!0,stroke:"#31d0c6",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:6,magnet:!0,stroke:"#31d0c6",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:6,magnet:!0,stroke:"#31d0c6",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]}},!0),q.kJ.registerNode("docker-service",{inherit:"rect",width:120,height:50,attrs:{body:{stroke:"#f39c12",strokeWidth:1,fill:"#fff3cd",rx:8,ry:8},text:{fontSize:12,fill:"#333",textWrap:{width:-10,height:-10,ellipsis:!0}}},ports:{groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#f39c12",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#f39c12",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#f39c12",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#f39c12",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]}},!0),q.kJ.registerNode("docker-script",{inherit:"rect",width:140,height:40,attrs:{body:{stroke:"#17a2b8",strokeWidth:1,fill:"#d1ecf1",rx:6,ry:6},text:{fontSize:11,fill:"#333",textWrap:{width:-10,height:-10,ellipsis:!0}}},ports:{groups:{top:{position:"top",attrs:{circle:{r:3,magnet:!0,stroke:"#17a2b8",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:3,magnet:!0,stroke:"#17a2b8",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:3,magnet:!0,stroke:"#17a2b8",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:3,magnet:!0,stroke:"#17a2b8",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]}},!0),q.kJ.registerNode("docker-image",{inherit:"rect",width:320,height:40,attrs:{body:{stroke:"#6f42c1",strokeWidth:1,fill:"#e2d9f3",rx:6,ry:6},text:{fontSize:12,fill:"#333",textWrap:{width:-10,height:-10,ellipsis:!0}}},ports:{groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#6f42c1",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#6f42c1",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#6f42c1",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#6f42c1",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]}},!0),q.kJ.registerNode("docker-volume",{inherit:"ellipse",width:180,height:50,attrs:{body:{stroke:"#20c997",strokeWidth:2,fill:"#d4edda"},text:{fontSize:10,fill:"#333",textWrap:{width:-20,height:-10,ellipsis:!0}}},ports:{groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#20c997",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#20c997",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#20c997",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#20c997",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]}},!0),q.kJ.registerNode("docker-user",{inherit:"rect",width:100,height:25,attrs:{body:{stroke:"#fd7e14",strokeWidth:1,fill:"#fff3cd",rx:4},text:{fontSize:10,fill:"#333",fontWeight:"bold",textWrap:{width:-10,height:-10,ellipsis:!0}}},ports:{groups:{top:{position:"top",attrs:{circle:{r:3,magnet:!0,stroke:"#fd7e14",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:3,magnet:!0,stroke:"#fd7e14",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:3,magnet:!0,stroke:"#fd7e14",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:3,magnet:!0,stroke:"#fd7e14",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]}},!0),q.kJ.registerNode("docker-port",{inherit:"polygon",width:80,height:40,attrs:{body:{refPoints:"0,10 60,0 80,10 60,20 0,10",stroke:"#dc3545",strokeWidth:1,fill:"#f8d7da"},text:{fontSize:12,fill:"#333",fontWeight:"bold"}},ports:{groups:{top:{position:"top",attrs:{circle:{r:3,magnet:!0,stroke:"#dc3545",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:3,magnet:!0,stroke:"#dc3545",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:3,magnet:!0,stroke:"#dc3545",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:3,magnet:!0,stroke:"#dc3545",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]}},!0),q.kJ.registerNode("docker-network",{inherit:"polygon",width:120,height:40,attrs:{body:{refPoints:"0,20 20,0 100,0 120,20 100,40 20,40",stroke:"#6c757d",strokeWidth:1,fill:"#e9ecef"},text:{fontSize:11,fill:"#333",textWrap:{width:-10,height:-10,ellipsis:!0}}},ports:{groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#6c757d",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#6c757d",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#6c757d",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#6c757d",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]}},!0),q.kJ.registerNode("docker-env",{inherit:"rect",width:200,height:80,attrs:{body:{stroke:"#17a2b8",strokeWidth:1,fill:"#d1ecf1",rx:5,ry:5},text:{fontSize:10,fill:"#0c5460",textAnchor:"start",textVerticalAnchor:"top",refX:5,refY:5,textWrap:{width:-10,height:-10,ellipsis:!1}}},ports:{groups:{top:{position:"top",attrs:{circle:{r:3,magnet:!0,stroke:"#17a2b8",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:3,magnet:!0,stroke:"#17a2b8",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:3,magnet:!0,stroke:"#17a2b8",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:3,magnet:!0,stroke:"#17a2b8",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]}},!0),q.kJ.registerNode("docker-build",{inherit:"rect",width:200,height:60,attrs:{body:{stroke:"#6f42c1",strokeWidth:1,fill:"#e7d9f5",rx:5,ry:5},text:{fontSize:10,fill:"#4a1d96",textAnchor:"start",textVerticalAnchor:"top",refX:5,refY:5,textWrap:{width:-10,height:-10,ellipsis:!1}}},ports:{groups:{top:{position:"top",attrs:{circle:{r:3,magnet:!0,stroke:"#6f42c1",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:3,magnet:!0,stroke:"#6f42c1",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:3,magnet:!0,stroke:"#6f42c1",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:3,magnet:!0,stroke:"#6f42c1",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]}},!0),q.kJ.registerNode("docker-ulimits",{inherit:"rect",width:200,height:80,attrs:{body:{stroke:"#e83e8c",strokeWidth:1,fill:"#f8d7e9",rx:5,ry:5},text:{fontSize:10,fill:"#721c47",textAnchor:"start",textVerticalAnchor:"top",refX:5,refY:5,textWrap:{width:-10,height:-10,ellipsis:!1}}},ports:{groups:{top:{position:"top",attrs:{circle:{r:3,magnet:!0,stroke:"#e83e8c",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:3,magnet:!0,stroke:"#e83e8c",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:3,magnet:!0,stroke:"#e83e8c",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:3,magnet:!0,stroke:"#e83e8c",strokeWidth:2,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]}},!0),q.kJ.registerNode("network-switch",{inherit:"rect",width:100,height:60,attrs:{body:{stroke:"#007bff",strokeWidth:2,fill:"#e7f3ff",rx:8,ry:8},text:{fontSize:12,fill:"#007bff",fontWeight:"bold",textWrap:{width:-10,height:-10,ellipsis:!0}}},ports:{groups:{left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#007bff",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#007bff",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#007bff",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#007bff",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"left",id:"port1"},{group:"right",id:"port2"},{group:"top",id:"port3"},{group:"bottom",id:"port4"}]}},!0),q.kJ.registerNode("network-router",{inherit:"rect",width:120,height:80,attrs:{body:{stroke:"#28a745",strokeWidth:2,fill:"#e8f5e8",rx:10,ry:10},text:{fontSize:12,fill:"#28a745",fontWeight:"bold",textWrap:{width:-10,height:-10,ellipsis:!0}}},ports:{groups:{left:{position:"left",attrs:{circle:{r:5,magnet:!0,stroke:"#28a745",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:5,magnet:!0,stroke:"#28a745",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},top:{position:"top",attrs:{circle:{r:5,magnet:!0,stroke:"#28a745",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"left",id:"lan1"},{group:"right",id:"lan2"},{group:"top",id:"wan"}]}},!0)},dt=function(){function ee(o){at()(this,ee),Te()(this,"graph",void 0),Te()(this,"components",new Map),Te()(this,"autoLayout",!0),this.graph=o}return st()(ee,[{key:"addContainer",value:function(e){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n={id:"container-".concat(Date.now()),type:"container",label:e,properties:u},a=this.graph.addNode({shape:"docker-container",label:"",position:this.getNextPosition("container")});return this.components.set(n.id,d()(d()({},n),{},{position:a.getPosition()})),this.autoLayout&&this.performAutoLayout(),{component:n,node:a}}},{key:"addService",value:function(e,u){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a={id:"service-".concat(Date.now()),type:"container",label:e,properties:n},i=this.graph.addNode({shape:"docker-service",label:e,position:{x:20,y:40}});return this.components.set(a.id,d()(d()({},a),{},{position:i.getPosition()})),{component:a,node:i}}},{key:"addScript",value:function(e,u){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"command",a={id:"script-".concat(Date.now()),type:n,label:e,properties:{text:e}},i=this.graph.addNode({shape:"docker-script",label:e,position:{x:180,y:40+(n==="entrypoint"?0:50)}});return this.components.set(a.id,d()(d()({},a),{},{position:i.getPosition()})),{component:a,node:i}}},{key:"addImage",value:function(e,u){var n={id:"image-".concat(Date.now()),type:"image",label:e,properties:{imageName:e}},a=this.graph.addNode({shape:"docker-image",label:e,position:{x:20,y:150}});return this.components.set(n.id,d()(d()({},n),{},{position:a.getPosition()})),{component:n,node:a}}},{key:"addVolume",value:function(e,u){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a={id:"volume-".concat(Date.now()),type:"volume",label:e,properties:{volumeMapping:e}},i=this.graph.addNode({shape:"docker-volume",label:e,position:{x:20+n*200,y:220}});return this.components.set(a.id,d()(d()({},a),{},{position:i.getPosition()})),{component:a,node:i}}},{key:"addPort",value:function(e,u){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a={id:"port-".concat(Date.now()),type:"port",label:e,properties:{port:e}},i=this.graph.addNode({shape:"docker-port",label:e,position:{x:1e3,y:20+n*50}});return this.components.set(a.id,d()(d()({},a),{},{position:i.getPosition()})),{component:a,node:i}}},{key:"addNetwork",value:function(e,u){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a={id:"network-".concat(Date.now()),type:"network",label:e,properties:{networkInfo:e}},i=this.graph.addNode({shape:"docker-network",label:e,position:{x:150,y:240+n*50}});return this.components.set(a.id,d()(d()({},a),{},{position:i.getPosition()})),{component:a,node:i}}},{key:"createDockerArchitecture",value:function(e){var u,n=this,a,i,s=e.position||this.getNextPosition("container"),g=this.graph.addNode({shape:"docker-container",x:s.x,y:s.y,width:720,height:320,zIndex:1,label:"",data:{config:e},attrs:{label:{refY:15,fontSize:12}}}),f=[],h=this.graph.addNode({shape:"docker-service",x:s.x+20,y:s.y+40,label:e.containerName,zIndex:10});if(f.push(h),e.user){var k=this.graph.addNode({shape:"docker-user",x:s.x+180,y:s.y+40,label:"user: ".concat(e.user),zIndex:10});f.push(k)}if(e.entrypoint){var F=this.graph.addNode({shape:"docker-script",x:s.x+20,y:s.y+100,label:e.entrypoint,zIndex:10,data:{scriptType:"entrypoint"}});f.push(F)}if(e.command){var M=this.graph.addNode({shape:"docker-script",x:s.x+200,y:s.y+100,label:e.command,data:{scriptType:"command"},zIndex:10});f.push(M)}if(e.build){var N="",I={};if(typeof e.build=="string")N="context: ".concat(e.build),I={context:e.build};else{var S=[];e.build.context&&S.push("context: ".concat(e.build.context)),e.build.dockerfile&&S.push("dockerfile: ".concat(e.build.dockerfile)),e.build.args&&(S.push("args:"),Object.entries(e.build.args).forEach(function(A){var z=j()(A,2),c=z[0],E=z[1];S.push("  ".concat(c,": ").concat(E))})),N=S.join(`
`),I=e.build}var C=this.graph.addNode({shape:"docker-build",x:s.x+20,y:s.y+160,label:N,zIndex:10,data:{build:I}});f.push(C)}if(e.image){var m=this.graph.addNode({shape:"docker-image",x:s.x+240,y:s.y+160,label:e.image,zIndex:10});f.push(m)}if((u=e.volumes)===null||u===void 0||u.forEach(function(A,z){var c=n.graph.addNode({shape:"docker-volume",x:s.x+20+z*200,y:s.y+220,label:A,zIndex:10});f.push(c)}),e.environment&&e.environment.length>0){var x=e.environment.join(`
`),D=this.graph.addNode({shape:"docker-env",x:s.x+20,y:s.y+270,label:x,zIndex:10,data:{envList:e.environment}});f.push(D)}if(e.ulimits){var L=[];Object.entries(e.ulimits).forEach(function(A){var z=j()(A,2),c=z[0],E=z[1];L.push("".concat(c,":")),De()(E)==="object"&&E!==null?(E.soft!==void 0&&L.push("  soft: ".concat(E.soft)),E.hard!==void 0&&L.push("  hard: ".concat(E.hard))):L.push("  ".concat(E))});var W=L.join(`
`),w=this.graph.addNode({shape:"docker-ulimits",x:s.x+240,y:s.y+270,label:W,zIndex:10,data:{ulimits:e.ulimits}});f.push(w)}(a=e.ports)===null||a===void 0||a.forEach(function(A,z){var c=n.graph.addNode({shape:"docker-port",x:s.x+380,y:s.y+40+z*50,label:A,zIndex:10});f.push(c)}),(i=e.networkInterfaces)===null||i===void 0||i.forEach(function(A,z){var c=A.ipConfig==="static"&&A.staticIP?"".concat(A.interfaceName,`
`).concat(A.staticIP):"".concat(A.interfaceName,`
dynamic`),E=n.graph.addNode({shape:"docker-network",x:s.x+580,y:s.y+240+z*55,label:c,zIndex:10});f.push(E),E.setData({networkInterface:A,isConnected:!1}),console.log("\u521B\u5EFA\u7F51\u7EDC\u63A5\u53E3: ".concat(A.interfaceName," -> ").concat(A.switchName),A)}),f.forEach(function(A){g.addChild(A)});var P={id:"container-".concat(Date.now()),type:"container",label:e.containerName,properties:e,position:g.getPosition()};return this.components.set(P.id,P),{containerNode:g,childNodes:f}}},{key:"getNextPosition",value:function(e){var u=this.graph.getNodes(),n=u.filter(function(a){return a.shape==="docker-container"});return{x:50,y:50+n.length*350}}},{key:"performAutoLayout",value:function(){}},{key:"getComponents",value:function(){return Array.from(this.components.values())}},{key:"clear",value:function(){this.components.clear(),this.graph.clearCells()}},{key:"getContainerCount",value:function(){var e=this.graph.getNodes().filter(function(u){return u.shape==="docker-container"});return e.length}},{key:"getAllContainers",value:function(){var e=this.graph.getNodes().filter(function(u){return u.shape==="docker-container"});return e.map(function(u){return{id:u.id,name:u.attr("text/text")||"container",position:u.getPosition(),children:(u.getChildren()||[]).map(function(n){return{id:n.id,shape:n.shape,label:n.attr("text/text")||""}})}})}},{key:"getDAGRelationships",value:function(){var e=this.getAllContainers(),u=this.graph.getEdges(),n={containers:e,connections:u.map(function(a){var i,s,g,f;return{id:a.id,source:(i=a.getSourceNode())===null||i===void 0?void 0:i.id,target:(s=a.getTargetNode())===null||s===void 0?void 0:s.id,sourceLabel:((g=a.getSourceNode())===null||g===void 0?void 0:g.attr("text/text"))||"",targetLabel:((f=a.getTargetNode())===null||f===void 0?void 0:f.attr("text/text"))||""}}),totalContainers:e.length,totalConnections:u.length};return n}},{key:"getTopologicalOrder",value:function(){var e=this.getAllContainers(),u=this.graph.getEdges(),n={},a={};e.forEach(function(h){n[h.id]=[],a[h.id]=0}),u.forEach(function(h){var k,F,M=(k=h.getSourceNode())===null||k===void 0?void 0:k.id,N=(F=h.getTargetNode())===null||F===void 0?void 0:F.id;M&&N&&(n[M].push(N),a[N]++)});var i=[],s=[];for(Object.keys(a).forEach(function(h){a[h]===0&&i.push(h)});i.length>0;){var g=i.shift();s.push(g),n[g].forEach(function(h){a[h]--,a[h]===0&&i.push(h)})}var f=s.length!==e.length;return{order:s.map(function(h){var k=e.find(function(F){return F.id===h});return{id:h,name:(k==null?void 0:k.name)||"Unknown"}}),hasCircle:f,isValidDAG:!f}}},{key:"createSwitch",value:function(e,u){var n=this.getNextSwitchPosition(),a=e;u&&u.subnet&&(a="".concat(e,`
`).concat(u.subnet));var i=this.graph.addNode({shape:"network-switch",x:n.x,y:n.y,label:a,zIndex:5,data:{switchName:e,networkConfig:u}});return u&&u.gateway&&this.createAndConnectRouter(i,e,u),console.log("\u521B\u5EFA\u4EA4\u6362\u673A: ".concat(e),u),i}},{key:"createAndConnectRouter",value:function(e,u,n){var a="".concat(u,"_router"),i=this.graph.getNodes().filter(function(h){var k=h.attr("text/text");return h.shape==="network-router"&&typeof k=="string"&&k.includes(a)});if(i.length===0){var s=n!=null&&n.gateway?"".concat(a,`
GW: `).concat(n.gateway):a,g=this.createRouter(s),f=e.getPosition();g.setPosition({x:f.x+100,y:f.y}),this.graph.addEdge({source:{cell:e.id,anchor:{name:"center"},connectionPoint:{name:"boundary"}},target:{cell:g.id,anchor:{name:"center"},connectionPoint:{name:"boundary"}},router:{name:"manhattan",args:{padding:1,startDirections:["right"],endDirections:["left"],step:10}},attrs:{line:{stroke:"#28a745",strokeWidth:3,targetMarker:{name:"block",width:8,height:6}}},zIndex:2}),console.log("\u521B\u5EFA\u8DEF\u7531\u5668\u5E76\u8FDE\u63A5: ".concat(a))}}},{key:"createRouter",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"Router",u=this.getNextRouterPosition(),n=this.graph.addNode({shape:"network-router",x:u.x,y:u.y,label:e,zIndex:5});return console.log("\u521B\u5EFA\u8DEF\u7531\u5668: ".concat(e)),n}},{key:"getNextSwitchPosition",value:function(){var e=this.graph.getNodes().filter(function(u){return u.shape==="network-switch"});return{x:800+e.length%3*150,y:100+Math.floor(e.length/3)*150}}},{key:"getNextRouterPosition",value:function(){var e=this.graph.getNodes().filter(function(i){return i.shape==="network-router"}),u=this.graph.getNodes().filter(function(i){return i.shape==="network-switch"}),n=800;u.length>0&&(n=Math.max.apply(Math,Me()(u.map(function(i){return i.getPosition().x}))));var a=n+200;return{x:a+e.length%2*150,y:100+Math.floor(e.length/2)*150}}},{key:"connectNetworkToSwitch",value:function(e,u){var n=this.graph.getNodes().filter(function(s){return s.shape==="network-switch"&&(s.attr("text/text")||"")===u}),a;n.length>0?(a=n[0],console.log("\u627E\u5230\u73B0\u6709\u4EA4\u6362\u673A: ".concat(u))):(console.log("\u672A\u627E\u5230\u4EA4\u6362\u673A ".concat(u,"\uFF0C\u81EA\u52A8\u521B\u5EFA")),a=this.createSwitch(u));var i=this.graph.addEdge({source:{cell:e.id,anchor:{name:"center"},connectionPoint:{name:"boundary"}},target:{cell:a.id,anchor:{name:"center"},connectionPoint:{name:"boundary"}},router:{name:"manhattan",args:{padding:1,startDirections:["right"],endDirections:["left"],step:10}},attrs:{line:{stroke:"#6c757d",strokeWidth:2,strokeDasharray:"2,2"}},data:{originalStroke:"#6c757d",originalWidth:2},labels:[{attrs:{text:{text:"\u7F51\u7EDC\u8FDE\u63A5",fontSize:10,fill:"#666"}}}]});return console.log("\u8FDE\u63A5\u7F51\u5361 ".concat(e.attr("text/text")||"network"," \u5230\u4EA4\u6362\u673A ").concat(u)),{edge:i,switchNode:a}}},{key:"connectSwitchToRouter",value:function(e){var u=this.graph.getNodes().filter(function(s){return s.shape==="network-router"});u.length===0&&(u=[this.createRouter("Default Router")]);var n=u[0],a=this.graph.getEdges().filter(function(s){var g,f;return((g=s.getSourceNode())===null||g===void 0?void 0:g.id)===e.id&&((f=s.getTargetNode())===null||f===void 0?void 0:f.id)===n.id});if(a.length>0)return console.log("\u4EA4\u6362\u673A ".concat(e.attr("text/text")||"switch"," \u5DF2\u7ECF\u8FDE\u63A5\u5230\u8DEF\u7531\u5668\uFF0C\u8DF3\u8FC7")),a[0];var i=this.graph.addEdge({source:{cell:e.id,anchor:{name:"center"},connectionPoint:{name:"boundary"}},target:{cell:n.id,anchor:{name:"center"},connectionPoint:{name:"boundary"}},router:{name:"manhattan",args:{padding:1,startDirections:["right"],endDirections:["left"],step:10}},attrs:{line:{stroke:"#28a745",strokeWidth:3,targetMarker:{name:"block",width:8,height:6}}},data:{originalStroke:"#28a745",originalWidth:3},labels:[{attrs:{text:{text:"Bridge",fontSize:10,fill:"#28a745"}}}]});return console.log("\u8FDE\u63A5\u4EA4\u6362\u673A ".concat(e.attr("text/text")||"switch"," \u5230\u8DEF\u7531\u5668")),i}},{key:"manualConnectNetworkToSwitch",value:function(e,u,n){var a=this,i=this.graph.getCellById(e);if(!i||i.shape!=="docker-network")return console.error("\u65E0\u6548\u7684\u7F51\u5361\u8282\u70B9"),!1;var s=this.graph.getConnectedEdges(i).filter(function(N){var I=N.getTargetNode();return I&&I.shape==="network-switch"});if(s.length>0)return console.log("\u7F51\u5361\u5DF2\u7ECF\u8FDE\u63A5\u5230\u4EA4\u6362\u673A\uFF0C\u8BF7\u5148\u65AD\u5F00\u8FDE\u63A5"),!1;var g=this.graph.getNodes().filter(function(N){return N.shape==="network-switch"&&(N.attr("text/text")||"")===u}),f;g.length>0?f=g[0]:f=this.createSwitch(u);var h=this.connectNetworkToSwitch(i,u),k=i.getData()||{},F=k.networkInterface||{};if(F.ipConfig==="static"&&F.staticIP){var M="".concat(F.interfaceName,`
`).concat(F.staticIP);i.attr("text/text",M)}return i.setData(d()(d()({},k),{},{isConnected:!0,connectedSwitch:u,switchNetworkConfig:n,networkInterface:d()(d()({},F),{},{switchName:u})})),h&&h.switchNode&&setTimeout(function(){a.connectSwitchToRouter(h.switchNode)},50),console.log("\u624B\u52A8\u8FDE\u63A5\u7F51\u5361 ".concat(i.attr("text/text")||"network"," \u5230\u4EA4\u6362\u673A ").concat(u)),!0}},{key:"disconnectNetworkFromSwitch",value:function(e){var u=this,n=this.graph.getCellById(e);if(!n||n.shape!=="docker-network")return console.error("\u65E0\u6548\u7684\u7F51\u5361\u8282\u70B9"),!1;var a=this.graph.getConnectedEdges(n).filter(function(i){var s=i.getTargetNode();return s&&s.shape==="network-switch"});return a.length===0?(console.log("\u7F51\u5361\u672A\u8FDE\u63A5\u5230\u4EFB\u4F55\u4EA4\u6362\u673A"),!1):(a.forEach(function(i){u.graph.removeCell(i)}),n.setData(d()(d()({},n.getData()),{},{isConnected:!1,connectedSwitch:void 0})),console.log("\u65AD\u5F00\u7F51\u5361 ".concat(n.attr("text/text")||"network"," \u7684\u8FDE\u63A5")),!0)}},{key:"getNetworkNodes",value:function(){return this.graph.getNodes().filter(function(e){return e.shape==="docker-network"})}},{key:"getSwitchNodes",value:function(){return this.graph.getNodes().filter(function(e){return e.shape==="network-switch"})}},{key:"isNetworkConnected",value:function(e){var u=this.graph.getCellById(e);if(!u)return!1;var n=this.graph.getConnectedEdges(u).filter(function(a){var i=a.getTargetNode();return i&&i.shape==="network-switch"});return n.length>0}},{key:"getConnectedSwitch",value:function(e){var u=this.graph.getCellById(e);if(!u)return null;var n=this.graph.getConnectedEdges(u).filter(function(i){var s=i.getTargetNode();return s&&s.shape==="network-switch"});if(n.length>0){var a=n[0].getTargetNode();return a&&a.attr("text/text")||null}return null}},{key:"addPortToContainer",value:function(e){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"8080",n=e.getChildren()||[],a=n.filter(function(f){return f.shape==="docker-port"}),i=e.getPosition(),s=70+a.length*30,g=this.graph.addNode({shape:"docker-port",x:i.x+500,y:i.y+s,label:u,zIndex:10});return e.addChild(g),console.log("\u6DFB\u52A0\u7AEF\u53E3: ".concat(u)),g}},{key:"addVolumeToContainer",value:function(e){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"/data:/app/data",n=e.getChildren()||[],a=n.filter(function(f){return f.shape==="docker-volume"}),i=e.getPosition(),s=180+a.length*30,g=this.graph.addNode({shape:"docker-volume",x:i.x+350,y:i.y+s,label:u,zIndex:10});return e.addChild(g),console.log("\u6DFB\u52A0\u5377: ".concat(u)),g}},{key:"addNetworkToContainer",value:function(e){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"eth0",n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"default",a=e.getChildren()||[],i=a.filter(function(k){return k.shape==="docker-network"}),s=e.getPosition(),g=e.getSize().height||320,f=g-80+i.length*55,h=this.graph.addNode({shape:"docker-network",x:s.x+580,y:s.y+f,label:u,zIndex:10,data:{networkInterface:{interfaceName:u,switchName:n,ipConfig:"dynamic"}}});return e.addChild(h),console.log("\u6DFB\u52A0\u7F51\u7EDC\u63A5\u53E3: ".concat(u," -> ").concat(n)),h}},{key:"removeChildComponent",value:function(e){var u=this,n=e.getParent();if(n){var a=n.getData()||{},i=a.config||{},s=e.shape,g=e.attr("text/text");switch(s){case"docker-user":n.setData(d()(d()({},a),{},{config:d()(d()({},i),{},{user:void 0})})),console.log("\u6E05\u7A7A\u5BB9\u5668 ".concat(n.attr("text/text")," \u7684\u7528\u6237\u914D\u7F6E"));break;case"docker-image":n.setData(d()(d()({},a),{},{config:d()(d()({},i),{},{image:"nginx:latest"})})),console.log("\u6E05\u7A7A\u5BB9\u5668 ".concat(n.attr("text/text")," \u7684\u955C\u50CF\u914D\u7F6E"));break;case"docker-port":var f=(i.ports||[]).filter(function(C){return C!==g});n.setData(d()(d()({},a),{},{config:d()(d()({},i),{},{ports:f})})),console.log("\u4ECE\u5BB9\u5668 ".concat(n.attr("text/text")," \u79FB\u9664\u7AEF\u53E3 ").concat(g));break;case"docker-volume":var h=(i.volumes||[]).filter(function(C){return C!==g});n.setData(d()(d()({},a),{},{config:d()(d()({},i),{},{volumes:h})})),console.log("\u4ECE\u5BB9\u5668 ".concat(n.attr("text/text")," \u79FB\u9664\u5377 ").concat(g));break;case"docker-script":var k=e.getData(),F=k==null?void 0:k.scriptType;F==="entrypoint"?(n.setData(d()(d()({},a),{},{config:d()(d()({},i),{},{entrypoint:""})})),console.log("\u6E05\u7A7A\u5BB9\u5668 ".concat(n.attr("text/text")," \u7684 entrypoint"))):(F==="command"||!F)&&(n.setData(d()(d()({},a),{},{config:d()(d()({},i),{},{command:"tail -f /etc/hosts"})})),console.log("\u6E05\u7A7A\u5BB9\u5668 ".concat(n.attr("text/text")," \u7684 command")));break;case"docker-network":var M=e.getData(),N=M==null?void 0:M.networkInterface;if(N){var I=(i.networkInterfaces||[]).filter(function(C){return C.interfaceName!==N.interfaceName});n.setData(d()(d()({},a),{},{config:d()(d()({},i),{},{networkInterfaces:I})})),console.log("\u4ECE\u5BB9\u5668 ".concat(n.attr("text/text")," \u79FB\u9664\u7F51\u7EDC\u63A5\u53E3 ").concat(N.interfaceName))}break}n.removeChild(e)}var S=this.graph.getConnectedEdges(e);S.forEach(function(C){return u.graph.removeEdge(C)}),this.graph.removeNode(e),console.log("\u5220\u9664\u7EC4\u4EF6: ".concat(e.shape))}},{key:"hasUniqueComponent",value:function(e,u){var n=e.getChildren()||[];return n.some(function(a){return a.shape===u})}},{key:"getContainerComponentStats",value:function(e){var u=e.getChildren()||[],n={service:u.filter(function(a){return a.shape==="docker-service"}).length,image:u.filter(function(a){return a.shape==="docker-image"}).length,user:u.filter(function(a){return a.shape==="docker-user"}).length,script:u.filter(function(a){return a.shape==="docker-script"}).length,port:u.filter(function(a){return a.shape==="docker-port"}).length,volume:u.filter(function(a){return a.shape==="docker-volume"}).length,network:u.filter(function(a){return a.shape==="docker-network"}).length};return n}}]),ee}(),r=_(52676),ft=function(o){var e=o.dockerFactory,u=o.onClose,n=(0,b.useState)("n1"),a=j()(n,2),i=a[0],s=a[1],g=(0,b.useState)("nginx:latest"),f=j()(g,2),h=f[0],k=f[1],F=(0,b.useState)(""),M=j()(F,2),N=M[0],I=M[1],S=(0,b.useState)("tail -f /etc/hosts"),C=j()(S,2),m=C[0],x=C[1],D=(0,b.useState)("80"),L=j()(D,2),W=L[0],w=L[1],P=(0,b.useState)(""),A=j()(P,2),z=A[0],c=A[1],E=(0,b.useState)("always"),y=j()(E,2),O=y[0],H=y[1],X=(0,b.useState)([]),J=j()(X,2),Z=J[0],Y=J[1],te=(0,b.useState)("nginx-tomcat"),U=j()(te,2),$=U[0],ue=U[1],ne=(0,b.useState)("172.20.0.0/16"),V=j()(ne,2),R=V[0],G=V[1],se=(0,b.useState)("172.20.0.1"),re=j()(se,2),ie=re[0],ve=re[1],ye=(0,b.useState)(["switch1","switch2"]),xe=j()(ye,2),Q=xe[0],B=xe[1],ce=(0,b.useState)([]),de=j()(ce,2),oe=de[0],ke=de[1],He=(0,b.useState)({switch1:{subnet:"172.18.0.0/16",gateway:"172.18.0.1"},switch2:{subnet:"172.19.0.0/16",gateway:"172.19.0.1"}}),ze=j()(He,2),ae=ze[0],Ge=ze[1],be=function(){if(e){var t=e.graph.getNodes().filter(function(v){return v.shape==="network-switch"}).map(function(v){return v.attr("text/text")||"switch"}),p=Me()(new Set([].concat(Me()(Q),Me()(t))));B(p)}},he=function(){if(e){var t=e.getNetworkNodes(),p=t.map(function(v){return{id:v.id,label:v.attr("text/text")||"network",isConnected:e.isNetworkConnected(v.id),connectedSwitch:e.getConnectedSwitch(v.id)}});ke(p)}},T=function(t,p){if(e){var v=ae[p],le=e.manualConnectNetworkToSwitch(t,p,v);le&&(he(),be())}},Ce=function(t){if(e){var p=e.disconnectNetworkFromSwitch(t);p&&he()}};b.useEffect(function(){e&&(be(),he())},[e]);var Le=function(){if(e){var t={containerName:i||"my-container",image:h||"docker.io/library/nginx:latest",entrypoint:N.trim()||void 0,command:m.trim()||"tail -f /etc/hosts",restart:O,ports:W.split(",").map(function(p){return p.trim()}).filter(Boolean),volumes:z.split(",").map(function(p){return p.trim()}).filter(Boolean),networkInterfaces:Z,switchNetworks:ae};e.createDockerArchitecture(t),setTimeout(function(){he()},200),u==null||u()}},Je=function(){if(!(!e||!$.trim())){var t=$.trim();if(Q.includes(t)){alert("\u4EA4\u6362\u673A\u5DF2\u5B58\u5728\uFF01");return}if(!R.trim()||!ie.trim()){alert("\u8BF7\u586B\u5199\u5B8C\u6574\u7684\u7F51\u7EDC\u914D\u7F6E\uFF01");return}e.createSwitch(t),Ge(function(le){return d()(d()({},le),{},Te()({},t,{subnet:R.trim(),gateway:ie.trim()}))}),setTimeout(function(){be()},100),ue("");var p=parseInt(R.split(".")[2]),v=p+1;G("172.".concat(v,".0.0/16")),ve("172.".concat(v,".0.1"))}},Ve=function(){var t={interfaceName:"eth".concat(Z.length),switchName:Q[0]||"",ipConfig:"dynamic",staticIP:void 0};Y(function(p){return[].concat(Me()(p),[t])})},Ue=function(t){Y(function(p){return p.filter(function(v,le){return le!==t})})},Ne=function(t,p,v){Y(function(le){return le.map(function(fe,we){if(we===t){var ge=d()(d()({},fe),{},Te()({},p,v));if(p==="ipConfig"&&v==="static"&&!ge.staticIP){var Ee=ae[ge.switchName];if(Ee){var je=Ee.gateway.split(".");je[3]=String(100+t),ge.staticIP=je.join(".")}}return p==="ipConfig"&&v==="dynamic"&&(ge.staticIP=void 0),ge}return fe})})},Qe=function(){e&&(e.clear(),B(["switch1","switch2"]),ke([]))},$e=function(){if(e){Q.includes("switch1")||e.createSwitch("switch1"),Q.includes("switch2")||e.createSwitch("switch2"),setTimeout(function(){be()},100);var t={containerName:"nginx-container",image:"docker.io/library/nginx:latest",entrypoint:"/docker-entrypoint",command:"nginx -g daemon off",ports:["8080","9090","9091"],volumes:["/data/container1/app:/app/data","/data/container1/app2:/app/data2"],networkInterfaces:[{interfaceName:"eth0",switchName:"switch1",ipConfig:"static",staticIP:"172.16.0.100"},{interfaceName:"eth1",switchName:"switch2",ipConfig:"dynamic"}]};e.createDockerArchitecture(t),setTimeout(function(){he()},200),u==null||u()}},pe={width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"13px",marginBottom:"8px"},Oe=d()(d()({},pe),{},{minHeight:"60px",resize:"vertical",fontFamily:"monospace"}),Be={padding:"10px 16px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px",marginRight:"8px",marginBottom:"8px"},Ke=d()(d()({},Be),{},{backgroundColor:"#dc3545"}),me={display:"block",marginBottom:"4px",fontSize:"13px",fontWeight:500,color:"#333"},Ie={marginBottom:"16px",padding:"12px",backgroundColor:"#fff",borderRadius:"6px",border:"1px solid #e9ecef"};return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{marginBottom:"16px",fontWeight:600,color:"#333",fontSize:"16px"},children:"\u{1F433} Docker \u914D\u7F6E\u9762\u677F"}),(0,r.jsxs)("div",{style:Ie,children:[(0,r.jsx)("h4",{style:{margin:"0 0 12px 0",color:"#495057",fontSize:"14px"},children:"\u57FA\u7840\u914D\u7F6E"}),(0,r.jsx)("label",{style:me,children:"\u5BB9\u5668\u540D\u79F0"}),(0,r.jsx)("input",{type:"text",value:i,onChange:function(t){return s(t.target.value)},placeholder:"\u5BB9\u5668\u540D\u79F0",style:pe}),(0,r.jsx)("label",{style:me,children:"\u955C\u50CF"}),(0,r.jsx)("input",{type:"text",value:h,onChange:function(t){return k(t.target.value)},placeholder:"docker.io/library/nginx:latest",style:pe})]}),(0,r.jsxs)("div",{style:Ie,children:[(0,r.jsx)("h4",{style:{margin:"0 0 12px 0",color:"#495057",fontSize:"14px"},children:"\u542F\u52A8\u914D\u7F6E"}),(0,r.jsx)("label",{style:me,children:"\u5165\u53E3\u70B9\u811A\u672C"}),(0,r.jsx)("input",{type:"text",value:N,onChange:function(t){return I(t.target.value)},placeholder:"/docker-entrypoint",style:pe}),(0,r.jsx)("label",{style:me,children:"\u542F\u52A8\u547D\u4EE4"}),(0,r.jsx)("input",{type:"text",value:m,onChange:function(t){return x(t.target.value)},placeholder:"tail -f /etc/hosts",style:pe}),(0,r.jsx)("label",{style:me,children:"\u91CD\u542F\u7B56\u7565"}),(0,r.jsxs)("select",{value:O,onChange:function(t){return H(t.target.value)},style:pe,children:[(0,r.jsx)("option",{value:"no",children:"no - \u4E0D\u81EA\u52A8\u91CD\u542F"}),(0,r.jsx)("option",{value:"always",children:"always - \u603B\u662F\u91CD\u542F"}),(0,r.jsx)("option",{value:"unless-stopped",children:"unless-stopped - \u9664\u975E\u624B\u52A8\u505C\u6B62"}),(0,r.jsx)("option",{value:"on-failure",children:"on-failure - \u4EC5\u6545\u969C\u65F6\u91CD\u542F"})]})]}),(0,r.jsxs)("div",{style:Ie,children:[(0,r.jsx)("h4",{style:{margin:"0 0 12px 0",color:"#495057",fontSize:"14px"},children:"\u7F51\u7EDC\u4E0E\u5B58\u50A8"}),(0,r.jsx)("label",{style:me,children:"\u7AEF\u53E3\u6620\u5C04 (\u9017\u53F7\u5206\u9694)"}),(0,r.jsx)("textarea",{value:W,onChange:function(t){return w(t.target.value)},placeholder:"8080,9090,9091",style:Oe}),(0,r.jsx)("label",{style:me,children:"\u5377\u6620\u5C04 (\u9017\u53F7\u5206\u9694)"}),(0,r.jsx)("textarea",{value:z,onChange:function(t){return c(t.target.value)},placeholder:"/host/path:/container/path",style:Oe}),(0,r.jsx)("label",{style:me,children:"\u4EA4\u6362\u673A\u7BA1\u7406"}),(0,r.jsxs)("div",{style:{marginBottom:"12px",padding:"8px",border:"1px solid #ddd",borderRadius:"4px",backgroundColor:"#f8f9fa"},children:[(0,r.jsx)("div",{style:{marginBottom:"6px",fontSize:"12px",fontWeight:"bold"},children:"\u521B\u5EFA\u65B0\u4EA4\u6362\u673A"}),(0,r.jsx)("div",{style:{marginBottom:"6px"},children:(0,r.jsx)("input",{type:"text",value:$,onChange:function(t){return ue(t.target.value)},placeholder:"\u4EA4\u6362\u673A\u540D\u79F0",style:d()(d()({},pe),{},{marginBottom:"0",fontSize:"12px"})})}),(0,r.jsxs)("div",{style:{display:"flex",gap:"4px",marginBottom:"6px"},children:[(0,r.jsx)("input",{type:"text",value:R,onChange:function(t){return G(t.target.value)},placeholder:"\u7F51\u7EDC\u5B50\u7F51 (\u5982: 172.20.0.0/16)",style:d()(d()({},pe),{},{marginBottom:"0",fontSize:"12px",flex:2})}),(0,r.jsx)("input",{type:"text",value:ie,onChange:function(t){return ve(t.target.value)},placeholder:"\u7F51\u5173 (\u5982: 172.20.0.1)",style:d()(d()({},pe),{},{marginBottom:"0",fontSize:"12px",flex:1})})]}),(0,r.jsx)("button",{onClick:Je,style:{width:"100%",padding:"6px 12px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"\u2795 \u521B\u5EFA\u4EA4\u6362\u673A"})]}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,r.jsx)("span",{style:{fontSize:"12px",color:"#666"},children:"\u7F51\u7EDC\u63A5\u53E3\u914D\u7F6E\uFF1A"}),(0,r.jsx)("button",{onClick:Ve,style:{padding:"4px 8px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"3px",cursor:"pointer",fontSize:"11px"},children:"\u2795 \u6DFB\u52A0\u63A5\u53E3"})]}),(0,r.jsx)("div",{style:{border:"1px solid #ddd",borderRadius:"4px",padding:"8px",maxHeight:"200px",overflowY:"auto"},children:Z.length===0?(0,r.jsx)("div",{style:{color:"#999",fontSize:"12px",textAlign:"center",padding:"16px"},children:'\u6682\u65E0\u7F51\u7EDC\u63A5\u53E3\uFF0C\u70B9\u51FB"\u6DFB\u52A0\u63A5\u53E3"\u521B\u5EFA'}):Z.map(function(l,t){return(0,r.jsxs)("div",{style:{border:"1px solid #e9ecef",borderRadius:"3px",padding:"8px",marginBottom:"8px",backgroundColor:"#f8f9fa"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},children:[(0,r.jsxs)("span",{style:{fontSize:"12px",fontWeight:"bold"},children:["\u63A5\u53E3 ",t+1]}),(0,r.jsx)("button",{onClick:function(){return Ue(t)},style:{padding:"2px 6px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"2px",cursor:"pointer",fontSize:"10px"},children:"\u5220\u9664"})]}),(0,r.jsxs)("div",{style:{marginBottom:"4px"},children:[(0,r.jsx)("label",{style:{fontSize:"11px",color:"#666"},children:"\u63A5\u53E3\u540D\u79F0\uFF1A"}),(0,r.jsx)("input",{type:"text",value:l.interfaceName,onChange:function(v){return Ne(t,"interfaceName",v.target.value)},style:{width:"100%",padding:"2px 4px",border:"1px solid #ddd",borderRadius:"2px",fontSize:"11px"}})]}),(0,r.jsxs)("div",{style:{marginBottom:"4px"},children:[(0,r.jsx)("label",{style:{fontSize:"11px",color:"#666"},children:"\u8FDE\u63A5\u4EA4\u6362\u673A\uFF1A"}),(0,r.jsx)("select",{value:l.switchName,onChange:function(v){return Ne(t,"switchName",v.target.value)},style:{width:"100%",padding:"2px 4px",border:"1px solid #ddd",borderRadius:"2px",fontSize:"11px"},children:Q.map(function(p){return(0,r.jsx)("option",{value:p,children:p},p)})})]}),ae[l.switchName]&&(0,r.jsxs)("div",{style:{padding:"4px",backgroundColor:"#e7f3ff",borderRadius:"2px",marginBottom:"4px",fontSize:"10px",color:"#0066cc"},children:["\u{1F4E1} \u7F51\u7EDC: ",ae[l.switchName].subnet,(0,r.jsx)("br",{}),"\u{1F3E0} \u7F51\u5173: ",ae[l.switchName].gateway]}),(0,r.jsxs)("div",{style:{marginBottom:"4px"},children:[(0,r.jsx)("label",{style:{fontSize:"11px",color:"#666"},children:"IP\u914D\u7F6E\uFF1A"}),(0,r.jsxs)("select",{value:l.ipConfig,onChange:function(v){return Ne(t,"ipConfig",v.target.value)},style:{width:"100%",padding:"2px 4px",border:"1px solid #ddd",borderRadius:"2px",fontSize:"11px"},children:[(0,r.jsx)("option",{value:"dynamic",children:"\u52A8\u6001\u5206\u914D (DHCP)"}),(0,r.jsx)("option",{value:"static",children:"\u9759\u6001IP"})]})]}),l.ipConfig==="static"&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{style:{fontSize:"11px",color:"#666"},children:"\u9759\u6001IP\u5730\u5740\uFF1A"}),(0,r.jsx)("input",{type:"text",value:l.staticIP||"",onChange:function(v){return Ne(t,"staticIP",v.target.value)},placeholder:ae[l.switchName]?"\u5728 ".concat(ae[l.switchName].subnet," \u4E2D\u7684IP"):"\u5982: 172.20.0.100",style:{width:"100%",padding:"2px 4px",border:"1px solid #ddd",borderRadius:"2px",fontSize:"11px"}}),ae[l.switchName]&&(0,r.jsxs)("div",{style:{fontSize:"9px",color:"#999",marginTop:"2px"},children:["\u{1F4A1} \u5EFA\u8BAEIP\u8303\u56F4: ",ae[l.switchName].subnet]})]})]},t)})}),(0,r.jsxs)("div",{style:{marginTop:"16px"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,r.jsx)("span",{style:{fontSize:"12px",color:"#666"},children:"\u73B0\u6709\u7F51\u5361\u8FDE\u63A5\u7BA1\u7406\uFF1A"}),(0,r.jsx)("button",{onClick:he,style:{padding:"4px 8px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"3px",cursor:"pointer",fontSize:"11px"},children:"\u{1F504} \u5237\u65B0"})]}),(0,r.jsx)("div",{style:{border:"1px solid #ddd",borderRadius:"4px",padding:"8px",maxHeight:"200px",overflowY:"auto"},children:oe.length===0?(0,r.jsx)("div",{style:{color:"#999",fontSize:"12px",textAlign:"center",padding:"16px"},children:"\u6682\u65E0\u7F51\u5361\u8282\u70B9\uFF0C\u8BF7\u5148\u521B\u5EFA\u5BB9\u5668\u67B6\u6784"}):oe.map(function(l){return(0,r.jsxs)("div",{style:{border:"1px solid #e9ecef",borderRadius:"3px",padding:"8px",marginBottom:"8px",backgroundColor:l.isConnected?"#e8f5e8":"#f8f9fa"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},children:[(0,r.jsxs)("span",{style:{fontSize:"12px",fontWeight:"bold",color:l.isConnected?"#28a745":"#6c757d"},children:["\u{1F4E1} ",l.label]}),(0,r.jsx)("span",{style:{fontSize:"10px",padding:"2px 6px",borderRadius:"10px",backgroundColor:l.isConnected?"#28a745":"#6c757d",color:"white"},children:l.isConnected?"\u5DF2\u8FDE\u63A5":"\u672A\u8FDE\u63A5"})]}),l.isConnected&&l.connectedSwitch&&(0,r.jsxs)("div",{style:{fontSize:"10px",color:"#28a745",marginBottom:"6px",padding:"2px 0"},children:["\u{1F517} \u8FDE\u63A5\u5230: ",l.connectedSwitch]}),(0,r.jsx)("div",{style:{display:"flex",gap:"4px",alignItems:"center"},children:l.isConnected?(0,r.jsx)("button",{onClick:function(){return Ce(l.id)},style:{width:"100%",padding:"2px 8px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"2px",cursor:"pointer",fontSize:"10px"},children:"\u65AD\u5F00\u8FDE\u63A5"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("select",{style:{flex:1,padding:"2px 4px",border:"1px solid #ddd",borderRadius:"2px",fontSize:"10px"},defaultValue:Q[0]||"",id:"switch-select-".concat(l.id),children:Q.map(function(t){return(0,r.jsx)("option",{value:t,children:t},t)})}),(0,r.jsx)("button",{onClick:function(){var p=document.getElementById("switch-select-".concat(l.id)),v=p==null?void 0:p.value;v&&T(l.id,v)},style:{padding:"2px 8px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"2px",cursor:"pointer",fontSize:"10px"},children:"\u8FDE\u63A5"})]})})]},l.id)})})]})]}),(0,r.jsxs)("div",{style:{borderTop:"1px solid #e9ecef",paddingTop:"16px"},children:[(0,r.jsx)("button",{onClick:Le,style:Be,title:"\u6839\u636E\u914D\u7F6E\u751F\u6210Docker\u67B6\u6784\u56FE",children:"\u{1F680} \u751F\u6210\u67B6\u6784\u56FE"}),(0,r.jsx)("button",{onClick:$e,style:d()(d()({},Be),{},{backgroundColor:"#28a745"}),title:"\u751F\u6210\u793A\u4F8BNginx\u67B6\u6784",children:"\u{1F4CB} \u793A\u4F8B\u67B6\u6784"}),(0,r.jsx)("button",{onClick:Qe,style:Ke,title:"\u6E05\u9664\u753B\u5E03\u4E0A\u7684\u6240\u6709\u5185\u5BB9",children:"\u{1F5D1}\uFE0F \u6E05\u9664\u753B\u5E03"}),(0,r.jsx)("button",{onClick:function(){if(e){var t=e.getContainerCount(),p=e.getDAGRelationships();alert("\u5BB9\u5668\u6570\u91CF: ".concat(t,`
DAG\u4FE1\u606F: `).concat(JSON.stringify(p,null,2)))}},style:d()(d()({},Be),{},{backgroundColor:"#6c757d"}),title:"\u67E5\u770B\u5BB9\u5668\u7EDF\u8BA1\u548CDAG\u5173\u7CFB",children:"\u{1F4CA} \u67E5\u770B\u7EDF\u8BA1"})]}),(0,r.jsxs)("div",{style:{marginTop:"16px",padding:"12px",backgroundColor:"#f8f9fa",borderRadius:"4px",fontSize:"12px",color:"#6c757d",lineHeight:"1.4"},children:[(0,r.jsx)("strong",{children:"\u{1F4A1} \u4F7F\u7528\u63D0\u793A\uFF1A"}),(0,r.jsx)("br",{}),"\u2022 \u5148\u521B\u5EFA\u4EA4\u6362\u673A\uFF0C\u7136\u540E\u9009\u62E9\u5BB9\u5668\u8981\u8FDE\u63A5\u7684\u4EA4\u6362\u673A",(0,r.jsx)("br",{}),'\u2022 \u70B9\u51FB"\u793A\u4F8B\u67B6\u6784"\u5FEB\u901F\u751F\u6210\u793A\u4F8B',(0,r.jsx)("br",{}),'\u2022 \u586B\u5199\u5404\u9879\u914D\u7F6E\u540E\u70B9\u51FB"\u751F\u6210\u67B6\u6784\u56FE"',(0,r.jsx)("br",{}),"\u2022 \u5BB9\u5668\u4F1A\u81EA\u52A8\u8FDE\u63A5\u5230\u9009\u4E2D\u7684\u4EA4\u6362\u673A",(0,r.jsx)("br",{}),"\u2022 \u652F\u6301\u591A\u4E2A\u7AEF\u53E3\u3001\u5377\u7528\u9017\u53F7\u5206\u9694",(0,r.jsx)("br",{}),"\u2022 \u751F\u6210\u540E\u53EF\u53CC\u51FB\u8282\u70B9\u7F16\u8F91\u6587\u672C\u5185\u5BB9"]})]})},Ae={YAML:"docker-compose-builder-yaml",TIMESTAMP:"docker-compose-builder-timestamp"},Ze=function(){var o=(0,b.useCallback)(function(a){try{return localStorage.setItem(Ae.YAML,a),localStorage.setItem(Ae.TIMESTAMP,new Date().toISOString()),console.log("\u81EA\u52A8\u4FDD\u5B58\u5230localStorage\u6210\u529F"),!0}catch(i){return console.warn("\u4FDD\u5B58\u5230localStorage\u5931\u8D25:",i),!1}},[]),e=(0,b.useCallback)(function(){try{var a=localStorage.getItem(Ae.YAML),i=localStorage.getItem(Ae.TIMESTAMP);if(!a||!i)return null;var s=new Date(i),g=new Date,f=(g.getTime()-s.getTime())/(1e3*60*60);return f>=24?null:{yaml:a,timestamp:s,hoursDiff:f}}catch(h){return console.warn("\u8BFB\u53D6localStorage\u5931\u8D25:",h),null}},[]),u=(0,b.useCallback)(function(){try{return localStorage.removeItem(Ae.YAML),localStorage.removeItem(Ae.TIMESTAMP),console.log("\u5DF2\u6E05\u7406localStorage\u6570\u636E"),!0}catch(a){return console.warn("\u6E05\u7406localStorage\u5931\u8D25:",a),!1}},[]),n=(0,b.useCallback)(function(a){var i=e();if(i){var s=window.confirm("\u53D1\u73B0 ".concat(Math.round(i.hoursDiff*10)/10,` \u5C0F\u65F6\u524D\u7684\u4FDD\u5B58\u6570\u636E\uFF0C\u662F\u5426\u6062\u590D\uFF1F

`)+"\u4FDD\u5B58\u65F6\u95F4: ".concat(i.timestamp.toLocaleString()));s&&(console.log("\u5F00\u59CB\u5C1D\u8BD5\u6062\u590D\u6570\u636E..."),a(i.yaml))}},[e]);return{saveYaml:o,loadYaml:e,clearStorage:u,checkAndPromptRestore:n}},ht=_(48464),pt=function ee(o){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,u="  ".repeat(e),n="",a=0,i=Object.entries(o);a<i.length;a++){var s=j()(i[a],2),g=s[0],f=s[1];if(f==null)n+="".concat(u).concat(g,`: null
`);else if(Array.isArray(f))f.length===0?n+="".concat(u).concat(g,`: []
`):(n+="".concat(u).concat(g,`:
`),f.forEach(function(k){if(De()(k)==="object"&&k!==null){var F=Object.keys(k);if(F.length===0)n+="".concat(u,`  - {}
`);else if(F.length===1){var M=j()(Object.entries(k)[0],2),N=M[0],I=M[1];n+="".concat(u,"  - ").concat(N,": ").concat(I,`
`)}else{var S=F[0],C=k[S];n+="".concat(u,"  - ").concat(S,": ").concat(C,`
`),F.slice(1).forEach(function(x){n+="".concat(u,"    ").concat(x,": ").concat(k[x],`
`)})}}else{var m=String(k);m.includes(":")||m.includes(" ")||m.includes("-")?n+="".concat(u,'  - "').concat(m,`"
`):n+="".concat(u,"  - ").concat(m,`
`)}}));else if(De()(f)==="object"&&f!==null)Object.keys(f).length===0?n+="".concat(u).concat(g,`: {}
`):(n+="".concat(u).concat(g,`:
`),n+=ee(f,e+1));else{var h=String(f);h.includes(":")||h.includes("#")||h.includes('"')?n+="".concat(u).concat(g,': "').concat(h,`"
`):n+="".concat(u).concat(g,": ").concat(h,`
`)}}return n},gt=function(o){try{return ht.Qc(o)}catch(u){console.error("YAML\u89E3\u6790\u9519\u8BEF:",u);var e=u instanceof Error?u.message:"YAML\u683C\u5F0F\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\u8BED\u6CD5";throw new Error(e)}},vt=function(o){var e={};if(o.image&&(e.image=o.image),o.build&&(e.build=o.build),o.user&&(e.user=o.user),o.entrypoint&&(o.entrypoint==="[]"?e.entrypoint=[]:o.entrypoint.trim()&&(o.entrypointIsArray?e.entrypoint=o.entrypoint.includes(" ")?o.entrypoint.split(" "):[o.entrypoint]:e.entrypoint=o.entrypoint)),o.command&&o.command!=="tail -f /etc/hosts"&&o.command.trim()&&(o.commandIsArray?e.command=o.command.includes(" ")?o.command.split(" "):[o.command]:e.command=o.command),o.ports&&o.ports.length>0&&(e.ports=o.ports),o.volumes&&o.volumes.length>0&&(e.volumes=o.volumes),o.environment&&(e.environment=o.environment),o.ulimits&&(e.ulimits=o.ulimits),o.networkInterfaces&&o.networkInterfaces.length>0){var u={};o.networkInterfaces.forEach(function(n){n.ipConfig==="static"&&n.staticIP?u[n.switchName]={ipv4_address:n.staticIP}:u[n.switchName]={}}),e.networks=u}return o.restart&&(e.restart=o.restart),o.depends_on&&o.depends_on.length>0&&(e.depends_on=o.depends_on),e},mt=function(o){var e={};return Object.entries(o).forEach(function(u){var n=j()(u,2),a=n[0],i=n[1];e[a]={driver:"bridge",ipam:{config:[{subnet:i.subnet,gateway:i.gateway}]}}}),e},xt=function(o,e){var u=Ze(),n=u.saveYaml,a=u.clearStorage,i=(0,b.useCallback)(function(){if(!e||!o)return console.log("Docker Factory\u6216Graph\u672A\u521D\u59CB\u5316"),"";var g=o.getNodes(),f=g.filter(function(I){return I.shape==="docker-container"});if(f.length===0)return a(),`# \u672A\u627E\u5230\u4EFB\u4F55Docker\u5BB9\u5668
version: "3.8"
services: {}`;var h={},k={},F=new Set;f.forEach(function(I){var S=I.getChildren()||[],C=I.getData(),m=(C==null?void 0:C.config)||{},x=S.find(function(B){return B.shape==="docker-service"}),D=x==null?void 0:x.attr("text/text"),L=(typeof D=="string"?D:null)||(typeof I.attr("text/text")=="string"?I.attr("text/text"):null)||"service",W=S.find(function(B){return B.shape==="docker-image"}),w=W==null?void 0:W.attr("text/text"),P=(typeof w=="string"?w:null)||"nginx:latest",A=S.find(function(B){return B.shape==="docker-user"}),z=(A==null?void 0:A.attr("text/text"))||"",c=z&&typeof z=="string"?z.replace("user: ",""):void 0,E=S.filter(function(B){return B.shape==="docker-script"}),y="",O="";E.forEach(function(B){var ce=B.getData(),de=ce==null?void 0:ce.scriptType,oe=B.attr("text/text");de==="entrypoint"?y=oe:(de==="command"||!de)&&(O=oe)});var H=S.filter(function(B){return B.shape==="docker-port"}),X=H.map(function(B){return B.attr("text/text")}),J=S.filter(function(B){return B.shape==="docker-volume"}),Z=J.map(function(B){return B.attr("text/text")});Z.forEach(function(B){if(B&&B.includes(":")){var ce=B.split(":"),de=j()(ce,1),oe=de[0];!oe.startsWith("/")&&!oe.startsWith(".")&&F.add(oe)}});var Y=S.filter(function(B){return B.shape==="docker-env"}),te=[];if(Y.length>0){var U=Y[0],$=U.getData();if($!=null&&$.envList&&Array.isArray($.envList))te=$.envList;else{var ue=U.attr("text/text")||"";te=ue.split(`
`).filter(function(B){return B.trim()})}}var ne=S.filter(function(B){return B.shape==="docker-build"}),V=void 0;if(ne.length>0){var R=ne[0],G=R.getData();G!=null&&G.build&&(V=G.build)}var se=S.filter(function(B){return B.shape==="docker-ulimits"}),re=void 0;if(se.length>0){var ie=se[0],ve=ie.getData();ve!=null&&ve.ulimits&&(re=ve.ulimits)}var ye=S.filter(function(B){return B.shape==="docker-network"}),xe=[];ye.forEach(function(B){var ce=B.getData(),de=ce==null?void 0:ce.networkInterface;de&&xe.push(de)});var Q={containerName:L,user:c,ports:X,volumes:Z,environment:te.length>0?te:m.environment||[],networkInterfaces:xe,switchNetworks:m.switchNetworks||{},entrypoint:y,entrypointIsArray:m.entrypointIsArray,command:O,commandIsArray:m.commandIsArray,restart:m.restart||"unless-stopped",depends_on:m.depends_on||[]};V&&(Q.build=V),P&&P!=="nginx:latest"?Q.image=P:V||(Q.image=P),re&&(Q.ulimits=re),h[L]=vt(Q),Q.switchNetworks&&Object.assign(k,Q.switchNetworks)});var M={version:"3.8",services:h};Object.keys(k).length>0&&(M.networks=mt(k)),F.size>0&&(M.volumes={},F.forEach(function(I){M.volumes[I]={}}));var N=pt(M);return n(N),N},[e,o,n,a]),s=(0,b.useCallback)(function(g){if(!e||!o||!g.trim())return console.log("\u8BF7\u8F93\u5165\u6709\u6548\u7684YAML\u5185\u5BB9"),!1;try{var f=gt(g);if(!f.services)throw new Error("\u672A\u627E\u5230services\u914D\u7F6E");var h=o.getNodes(),k=h.filter(function(w){return w.shape==="docker-container"});if(k.length>0){var F=window.confirm("\u753B\u5E03\u4E0A\u5DF2\u6709\u5BB9\u5668\uFF0C\u662F\u5426\u6E05\u7A7A\u73B0\u6709\u5185\u5BB9\uFF1F");F&&o.clearCells()}var M=750,N=350,I=50,S=50,C=50,m=50,x=2,D={};Object.entries(f.services).forEach(function(w,P){var A=j()(w,2),z=A[0],c=A[1],E=c.ports?Array.isArray(c.ports)?c.ports:[c.ports]:[],y=c.volumes?Array.isArray(c.volumes)?c.volumes:[c.volumes]:[],O=[];c.networks&&(Array.isArray(c.networks)?c.networks.forEach(function(V,R){O.push({interfaceName:"eth".concat(R),switchName:V,ipConfig:"dynamic"})}):De()(c.networks)==="object"&&Object.entries(c.networks).forEach(function(V,R){var G=j()(V,2),se=G[0],re=G[1];O.push({interfaceName:"eth".concat(R),switchName:se,ipConfig:"static",staticIP:re.ipv4_address||"172.20.0.100"})}));var H=Math.floor(P/x),X=P%x,J=C+X*(M+I),Z=m+H*(N+S),Y=[];c.environment&&(Array.isArray(c.environment)?Y=c.environment:De()(c.environment)==="object"&&(Y=Object.entries(c.environment).map(function(V){var R=j()(V,2),G=R[0],se=R[1];return"".concat(G,"=").concat(se)})));var te=e.createDockerArchitecture({containerName:z,image:c.image,build:c.build,user:c.user,entrypoint:c.entrypoint!==void 0?Array.isArray(c.entrypoint)?c.entrypoint.length>0?c.entrypoint.join(" "):"[]":c.entrypoint:void 0,command:c.command?Array.isArray(c.command)?c.command.join(" "):c.command:void 0,ports:E,volumes:y,environment:Y,ulimits:c.ulimits,networkInterfaces:O,position:{x:J,y:Z}}),U=te.containerNode;D[z]=U;var $={};f.networks&&Object.entries(f.networks).forEach(function(V){var R,G,se=j()(V,2),re=se[0],ie=se[1];$[re]={subnet:(ie==null||(R=ie.ipam)===null||R===void 0||(R=R.config)===null||R===void 0||(R=R[0])===null||R===void 0?void 0:R.subnet)||"172.20.0.0/16",gateway:(ie==null||(G=ie.ipam)===null||G===void 0||(G=G.config)===null||G===void 0||(G=G[0])===null||G===void 0?void 0:G.gateway)||"172.20.0.1"}});var ue=[];c.depends_on&&(Array.isArray(c.depends_on)?ue=c.depends_on:De()(c.depends_on)==="object"&&(ue=Object.keys(c.depends_on)));var ne={containerName:z,user:c.user,ports:E,volumes:y,environment:c.environment||[],networkInterfaces:O,switchNetworks:$,entrypoint:c.entrypoint!==void 0?Array.isArray(c.entrypoint)?c.entrypoint.length>0?c.entrypoint.join(" "):"[]":c.entrypoint:"",entrypointIsArray:Array.isArray(c.entrypoint),command:c.command?Array.isArray(c.command)?c.command.join(" "):c.command:void 0,commandIsArray:Array.isArray(c.command),restart:c.restart||"unless-stopped",depends_on:ue};c.build&&(ne.build=c.build),c.image?ne.image=c.image:c.build||(ne.image="docker.io/library/nginx:latest"),c.ulimits&&(ne.ulimits=c.ulimits),U.setData({config:ne}),U.attr("text/text","")});var L={};return f.networks&&Object.keys(f.networks).forEach(function(w,P){var A=o.getNodes().find(function(U){if(U.shape==="network-switch"){var $=U.getData();return($==null?void 0:$.switchName)===w}return!1});if(!A){var z,c,E,y=(z=f.networks)===null||z===void 0?void 0:z[w],O=y?{subnet:(c=y.ipam)===null||c===void 0||(c=c.config)===null||c===void 0||(c=c[0])===null||c===void 0?void 0:c.subnet,gateway:(E=y.ipam)===null||E===void 0||(E=E.config)===null||E===void 0||(E=E[0])===null||E===void 0?void 0:E.gateway}:void 0,H=O?{subnet:O.subnet}:void 0;A=e.createSwitch(w,H);var X=C+x*(M+I)+100,J=m+P*150;if(A.setPosition({x:X,y:J}),O!=null&&O.gateway){var Z="".concat(w,"_router"),Y="".concat(Z,`
GW: `).concat(O.gateway),te=e.createRouter(Y);te.setPosition({x:X+200,y:J}),o.addEdge({source:{cell:A.id,anchor:{name:"center"},connectionPoint:{name:"boundary"}},target:{cell:te.id,anchor:{name:"center"},connectionPoint:{name:"boundary"}},router:{name:"manhattan",args:{padding:1,startDirections:["right"],endDirections:["left"],step:10}},attrs:{line:{stroke:"#28a745",strokeWidth:3}},zIndex:2,data:{originalStroke:"#28a745",originalWidth:3}})}}L[w]=A}),setTimeout(function(){Object.values(D).forEach(function(z){var c=z.getChildren()||[],E=c.filter(function(y){return y.shape==="docker-network"});E.forEach(function(y){var O=y.getData(),H=O==null?void 0:O.networkInterface;if(H&&H.switchName){var X=L[H.switchName];if(X){var J=o.getCellById(y.id),Z=o.getCellById(X.id);if(!J||!Z){console.error("\u8282\u70B9\u4E0D\u5B58\u5728\uFF0C\u8DF3\u8FC7\u8FDE\u63A5");return}o.addEdge({source:{cell:y.id,anchor:{name:"center"},connectionPoint:{name:"boundary"}},target:{cell:X.id,anchor:{name:"center"},connectionPoint:{name:"boundary"}},router:{name:"manhattan",args:{padding:1,startDirections:["right"],endDirections:["left"],step:10}},attrs:{line:{stroke:"#28a745",strokeWidth:2,targetMarker:{name:"block",width:8,height:6}}},zIndex:1}),console.log("\u8FDE\u63A5\u7F51\u5361 ".concat(H.interfaceName," \u5230\u4EA4\u6362\u673A ").concat(H.switchName))}}})}),console.log("\u6240\u6709\u7F51\u7EDC\u8FDE\u63A5\u521B\u5EFA\u5B8C\u6210");var w={},P={},A={};Object.entries(f.services).forEach(function(z){var c,E=j()(z,2),y=E[0],O=E[1],H=D[y];if(H){var X=H.getData(),J=(X==null||(c=X.config)===null||c===void 0?void 0:c.depends_on)||[];J.forEach(function(Z){var Y=D[Z];if(Y){var te=Y.getBBox(),U=H.getBBox(),$=U.center.x-te.center.x,ue=U.center.y-te.center.y,ne,V;Math.abs($)>Math.abs(ue)?$>0?(ne="right",V="left"):(ne="left",V="right"):ue>0?(ne="bottom",V="top"):(ne="top",V="bottom");var R=P[Y.id];if(!R){R={portId:"out-port",group:ne},P[Y.id]=R;var G=Y.getPorts(),se=G.some(function(Q){return Q.id==="out-port"});se||Y.addPort({id:"out-port",group:ne})}var re=w[H.id];if(!re){re={portId:"in-port",group:V},w[H.id]=re;var ie=H.getPorts(),ve=ie.some(function(Q){return Q.id==="in-port"});ve||H.addPort({id:"in-port",group:V})}var ye=A[Y.id]||0;A[Y.id]=ye+1;var xe=32+ye%3*16;o.addEdge({source:{cell:Y.id,port:R.portId},target:{cell:H.id,port:re.portId},router:{name:"er",args:{offset:xe,direction:"H"}},attrs:{line:{stroke:"#ff6b6b",strokeWidth:2,strokeDasharray:"5 5",targetMarker:{name:"block",width:8,height:6}}},zIndex:10,data:{type:"dependency",originalStroke:"#ff6b6b",originalWidth:2}}),console.log("\u521B\u5EFA\u4F9D\u8D56\u5173\u7CFB\u8FDE\u63A5: ".concat(Z," -> ").concat(y," (\u6E90\u7AEF\u53E3: ").concat(R.portId,", \u76EE\u6807\u7AEF\u53E3: ").concat(re.portId,")"))}})}}),console.log("\u6240\u6709\u4F9D\u8D56\u5173\u7CFB\u8FDE\u63A5\u521B\u5EFA\u5B8C\u6210")},100),n(g),console.log("Docker Compose\u5BFC\u5165\u6210\u529F - \u5305\u542B\u7F51\u7EDC\u62D3\u6251"),!0}catch(w){console.error("\u5BFC\u5165\u5931\u8D25:",w);var W=w instanceof Error?w.message:"\u672A\u77E5\u9519\u8BEF";return alert("\u5BFC\u5165\u5931\u8D25: ".concat(W)),!1}},[e,o,n]);return{exportDockerCompose:i,importDockerCompose:s}},yt=function(o,e){var u=(0,b.useState)({visible:!1,x:0,y:0,node:null,nodeType:""}),n=j()(u,2),a=n[0],i=n[1],s=(0,b.useState)(!1),g=j()(s,2),f=g[0],h=g[1],k=(0,b.useState)(null),F=j()(k,2),M=F[0],N=F[1],I=(0,b.useState)({interfaceName:"",switchName:"",ipConfig:"dynamic",staticIP:""}),S=j()(I,2),C=S[0],m=S[1],x=(0,b.useCallback)(function(W,w){W.preventDefault();var P="";w.shape==="docker-container"?P="container":["docker-service","docker-image","docker-port","docker-volume","docker-network","docker-script","docker-user"].includes(w.shape)?P="component":P="other",i({visible:!0,x:W.clientX,y:W.clientY,node:w,nodeType:P})},[]),D=(0,b.useCallback)(function(){i(function(W){return d()(d()({},W),{},{visible:!1})})},[]),L=(0,b.useCallback)(function(W){if(!(!e||!a.node)){var w=a.node;switch(W){case"add-port":if(w.shape==="docker-container"){var P=prompt("\u8BF7\u8F93\u5165\u7AEF\u53E3\u6620\u5C04 (\u4F8B\u5982: 8080:80)","8080:80");P&&e.addPortToContainer(w,P)}break;case"add-volume":if(w.shape==="docker-container"){var A=prompt("\u8BF7\u8F93\u5165\u5377\u6302\u8F7D (\u4F8B\u5982: /host/path:/container/path)","/data:/app/data");A&&e.addVolumeToContainer(w,A)}break;case"add-network":if(w.shape==="docker-container"){for(var z=w.getChildren()||[],c=z.filter(function(J){return J.shape==="docker-network"}).map(function(J){var Z,Y,te=J.getData()||{};return((Z=te.networkInterface)===null||Z===void 0?void 0:Z.interfaceName)||((Y=J.attr("text/text"))===null||Y===void 0?void 0:Y.split(`
`)[0])||""}),E="eth0",y=0;c.includes(E);)y++,E="eth".concat(y);m({interfaceName:E,switchName:"",ipConfig:"dynamic",staticIP:""}),N(w),h(!0)}break;case"add-user":if(w.shape==="docker-container"){if(e.hasUniqueComponent(w,"docker-user")){alert("\u5BB9\u5668\u5DF2\u6709\u7528\u6237\u914D\u7F6E\uFF0C\u6BCF\u4E2A\u5BB9\u5668\u53EA\u80FD\u6709\u4E00\u4E2A\u7528\u6237\u914D\u7F6E");break}var O=prompt("\u8BF7\u8F93\u5165\u7528\u6237\u914D\u7F6E (\u4F8B\u5982: root \u6216 1000:1000)","root");if(O){var H=w.getPosition(),X=o==null?void 0:o.addNode({shape:"docker-user",x:H.x+180,y:H.y+40,label:"user: ".concat(O),zIndex:10});X&&w.addChild(X)}}break;case"delete-component":a.nodeType==="component"&&confirm("\u786E\u5B9A\u8981\u5220\u9664\u6B64\u7EC4\u4EF6\u5417\uFF1F")&&e.removeChildComponent(w);break}D()}},[e,a.node,a.nodeType,o,D]);return{contextMenu:a,handleContextMenu:x,hideContextMenu:D,handleMenuItemClick:L,showNetworkModal:f,setShowNetworkModal:h,currentContainerNode:M,networkModalData:C,setNetworkModalData:m}},kt=function(o,e,u,n){return{container:o,width:u,height:n,grid:!0,scroller:{enabled:!0,pannable:!1,pageVisible:!1,pageBreak:!1,autoResize:!0,padding:50},mousewheel:{enabled:!0,zoomAtMousePosition:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:{name:"manhattan",args:{padding:1,startDirections:["right"],endDirections:["left"],step:10,excludeTerminals:[]}},connector:{name:"rounded",args:{radius:8}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,snap:{radius:20},createEdge:function(){return new q.bn.kS({attrs:{line:{stroke:"#A2B1C3",strokeWidth:2,targetMarker:{name:"block",width:12,height:8}}},zIndex:0})},validateConnection:function(i){var s=i.targetMagnet;return!!s}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}},resizing:!0,rotating:!0,selecting:{enabled:!0,rubberband:!0,showNodeSelectionBox:!0,showEdgeSelectionBox:!0,movable:!0,multiple:!0,strict:!1,following:!0},snapline:{enabled:!0},keyboard:!0,clipboard:!0,history:!0,minimap:{enabled:!0,container:e,width:250,height:150,padding:10,scalable:!0,graphOptions:{async:!0,createCellView:function(i){if(i.isEdge())return null}}}}},Pe=function(o){var e=new Set(o),u=function n(a){var i=a.getChildren();i&&i.length>0&&i.forEach(function(s){e.add(s),n(s)})};return o.forEach(function(n){u(n)}),Array.from(e)},bt=function(o,e,u){var n=(0,b.useCallback)(function(){if(o){o.bindKey(["meta+c","ctrl+c"],function(){var i=o.getSelectedCells();if(i.length){var s=Pe(i),g=s.filter(function(h){return h.isNode()}),f=s.filter(function(h){return h.isEdge()});o.copy(s),console.log("\u5DF2\u590D\u5236: \u76F4\u63A5\u9009\u4E2D ".concat(i.length," \u4E2A\u5143\u7D20\uFF0C\u5305\u542B\u7236\u5B50\u5173\u7CFB\u540E ").concat(s.length," \u4E2A\u5143\u7D20"),{\u9009\u4E2D:i.length,\u603B\u8BA1:s.length,\u8282\u70B9:g.length,\u8FB9:f.length})}return!1}),o.bindKey(["meta+x","ctrl+x"],function(){var i=o.getSelectedCells();if(i.length){var s=Pe(i),g=s.filter(function(h){return h.isNode()}),f=s.filter(function(h){return h.isEdge()});o.cut(s),console.log("\u5DF2\u526A\u5207: \u76F4\u63A5\u9009\u4E2D ".concat(i.length," \u4E2A\u5143\u7D20\uFF0C\u5305\u542B\u7236\u5B50\u5173\u7CFB\u540E ").concat(s.length," \u4E2A\u5143\u7D20"),{\u9009\u4E2D:i.length,\u603B\u8BA1:s.length,\u8282\u70B9:g.length,\u8FB9:f.length})}return!1}),o.bindKey(["meta+v","ctrl+v"],function(){if(!o.isClipboardEmpty()){var i=o.paste({offset:32});i.forEach(function(s,g){if(s.isNode()&&s.shape==="docker-container"){for(var f=s.getData()||{},h=f.config||{},k=s.attr("text/text")||"",F=k||h.containerName||"container",M=F.replace(/\d+$/,""),N=2,I=(o==null?void 0:o.getNodes().filter(function(D){return D.shape==="docker-container"}))||[],S=I.map(function(D){return D.attr("text/text")||""});S.includes("".concat(M).concat(N));)N++;var C="".concat(M).concat(N),m=C,x={containerName:m,image:h.image||"docker.io/library/nginx:latest",ports:h.ports||["80"],volumes:h.volumes||[],environment:h.environment||[],networkInterfaces:h.networkInterfaces||[{interfaceName:"eth0",switchName:"nginx-tomcat",ipConfig:"static",staticIP:"172.20.0.".concat(100+g)}],switchNetworks:h.switchNetworks||{"nginx-tomcat":{subnet:"172.20.0.0/16",gateway:"172.20.0.1"},switch1:{subnet:"172.18.0.0/16",gateway:"172.18.0.1"},switch2:{subnet:"172.19.0.0/16",gateway:"172.19.0.1"}},entrypoint:h.entrypoint||"",entrypointIsArray:h.entrypointIsArray,command:h.command||"tail -f /etc/hosts",commandIsArray:h.commandIsArray,restart:h.restart||"unless-stopped"};s.attr("text/text",C),s.setData(d()(d()({},f),{},{config:x}))}}),o.cleanSelection(),o.select(i),console.log("\u5DF2\u7C98\u8D34 ".concat(i.length," \u4E2A\u5143\u7D20"))}return!1}),o.bindKey(["meta+z","ctrl+z"],function(){return o.history.canUndo()&&o.history.undo(),!1}),o.bindKey(["meta+shift+z","ctrl+shift+z","ctrl+y","meta+y"],function(){return o.history.canRedo()&&o.history.redo(),!1}),o.bindKey(["meta+a","ctrl+a"],function(){var i=o.getNodes();i&&o.select(i)});var a=function(){var s=document.activeElement,g=s&&(s.tagName==="INPUT"||s.tagName==="TEXTAREA"||s.tagName==="SELECT"||s.getAttribute("contenteditable")==="true"||s.isContentEditable||s.tagName==="DIV"&&s.closest(".x6-widget-text-editor")),f=s&&(s.closest(".ant-modal")||s.closest('[role="dialog"]')||u);if(g||f)return!1;var h=o.getSelectedCells();if(h.length){var k=Pe(h),F=k.filter(function(N){return N.isNode()}),M=k.filter(function(N){return N.isEdge()});return o.removeCells(k),console.log("\u5DF2\u5220\u9664: \u76F4\u63A5\u9009\u4E2D ".concat(h.length," \u4E2A\u5143\u7D20\uFF0C\u5305\u542B\u7236\u5B50\u5173\u7CFB\u540E ").concat(k.length," \u4E2A\u5143\u7D20"),{\u9009\u4E2D:h.length,\u603B\u8BA1:k.length,\u8282\u70B9:F.length,\u8FB9:M.length}),!0}return!1};o.bindKey("delete",function(){var i=a();return i}),o.bindKey(["ctrl+1","meta+1"],function(){var i=o.zoom();i<1.5&&o.zoom(.1)}),o.bindKey(["ctrl+2","meta+2"],function(){var i=o.zoom();i>.5&&o.zoom(-.1)})}},[o,u]);return(0,b.useEffect)(function(){var a=!1,i=function(f){if(f.code==="Space"&&!a){var h=document.activeElement,k=h&&(h.tagName==="INPUT"||h.tagName==="TEXTAREA"||h.tagName==="SELECT"||h.getAttribute("contenteditable")==="true");if(k)return;f.preventDefault(),a=!0,e&&e(!0)}},s=function(f){f.code==="Space"&&a&&(f.preventDefault(),a=!1,e&&e(!1))};return document.addEventListener("keydown",i),document.addEventListener("keyup",s),function(){document.removeEventListener("keydown",i),document.removeEventListener("keyup",s)}},[e]),{bindShortcuts:n}},Ct=function(o){var e=(0,b.useState)(!1),u=j()(e,2),n=u[0],a=u[1],i=(0,b.useCallback)(function(s){o&&(a(s),s?(o.enablePanning(),o.disableSelection(),o.disableRubberband()):(o.disablePanning(),o.enableSelection(),o.enableRubberband()))},[o]);return{isDragMode:n,togglePanningMode:i}},wt=function(o){var e=(0,b.useCallback)(function(){o&&o.getCells().forEach(function(i){i.removeTools()})},[o]),u=function(s,g){o&&s.addTools([{name:"node-editor",args:{event:g}}])},n=(0,b.useCallback)(function(i,s){o&&i.addTools([{name:"edge-editor",args:{event:s}}])},[o]),a=(0,b.useCallback)(function(i,s){i.isNode()?u(i,s):i.isEdge()&&n(i,s)},[u,n]);return{clearAllEditingTools:e,addNodeEditor:u,addEdgeEditor:n,handleDoubleClick:a}},Et=function(o){var e=o.graph,u=o.handleContextMenu,n=o.hideContextMenu,a=o.handleDoubleClick;(0,b.useEffect)(function(){if(e){var i=function(C,m){for(var x=0,D=C.length;x<D;x=x+1)C[x].style.visibility=m?"visible":"hidden"},s=function(C){var m=C.e,x=C.node;u(m,x)},g=function(){n()},f=function(C){var m=C.node,x=C.e;a(m,x)},h=function(C){var m=C.cell,x=C.e;a(m,x)},k=function(C){var m=C.node,x=[];if(m.shape==="docker-container")x=[m];else if(["docker-service","docker-script","docker-image","docker-volume","docker-port","docker-network","docker-env"].includes(m.shape)){var D=m.getParent();D&&D.shape==="docker-container"&&(x=[D]),x.push(m)}else["network-switch","network-router"].includes(m.shape)?x=[m]:x=[m];x.forEach(function(L){var W,w=(W=e.findViewByCell(L))===null||W===void 0?void 0:W.container;if(w){var P=w.querySelectorAll(".x6-port-body");i(P,!0)}})},F=function(C){var m=C.node,x=C.e;setTimeout(function(){var D=document.elementFromPoint(x.clientX||0,x.clientY||0),L=D==null?void 0:D.closest(".x6-node");if(!L){var W=e.container,w=W.querySelectorAll(".x6-port-body");i(w,!1)}},100)},M=function(C){var m=C.edge;if(m.addTools([{name:"vertices",args:{attrs:{fill:"#007bff",stroke:"#fff","stroke-width":2},snapRadius:20}},{name:"segments",args:{threshold:40,attrs:{width:20,height:8,x:-10,y:-4,rx:4,ry:4,fill:"#007bff",stroke:"#fff","stroke-width":2}}},{name:"source-arrowhead",args:{attrs:{fill:"#28a745",stroke:"#fff","stroke-width":2,cursor:"move"}}},{name:"target-arrowhead",args:{attrs:{fill:"#dc3545",stroke:"#fff","stroke-width":2,cursor:"move"}}},{name:"button-remove",args:{distance:20,markup:[{tagName:"circle",selector:"button",attrs:{r:8,stroke:"#dc3545","stroke-width":2,fill:"#fff",cursor:"pointer"}},{tagName:"text",textContent:"\xD7",selector:"icon",attrs:{fill:"#dc3545","font-size":12,"text-anchor":"middle","pointer-events":"none",y:"0.3em","font-weight":"bold"}}]}}]),!e.isSelected(m)){var x=m.getData()||{},D=x.originalStroke||"#6c757d",L=x.originalWidth||2,W="#007bff";x.type==="dependency"&&(W="#e63946"),m.attr({line:{strokeWidth:L+2,stroke:W}}),x.originalStroke?m.setData(d()(d()({},x),{},{isHovering:!0})):m.setData(d()(d()({},x),{},{originalStroke:D,originalWidth:L,isHovering:!0}))}},N=function(C){var m,x=C.edge;if(x.removeTools(),!e.isSelected(x)&&(m=x.getData())!==null&&m!==void 0&&m.isHovering){var D=x.getData();x.attr({line:{strokeWidth:D.originalWidth||2,stroke:D.originalStroke||"#6c757d"}}),x.setData(d()(d()({},D),{},{isHovering:!1}))}},I=function(C){var m=C.added,x=C.removed;x.forEach(function(L){L.isEdge()&&L.removeTools()});var D=e.getSelectedCells();console.log("\u9009\u4E2D\u7684\u5355\u5143\u683C:",D)};return e.on("node:contextmenu",s),e.on("blank:click",g),e.on("node:dblclick",f),e.on("node:mouseenter",k),e.on("node:mouseleave",F),e.on("edge:mouseenter",M),e.on("edge:mouseleave",N),e.on("selection:changed",I),document.addEventListener("click",n),function(){e.off("node:contextmenu",s),e.off("blank:click",g),e.off("node:dblclick",f),e.off("node:mouseenter",k),e.off("node:mouseleave",F),e.off("edge:mouseenter",M),e.off("edge:mouseleave",N),e.off("selection:changed",I),document.removeEventListener("click",n)}}},[e,u,n,a])},Ft=function(){var o,e=(0,b.useRef)(null),u=(0,b.useRef)(null),n=(0,b.useRef)(null),a=(0,b.useState)(),i=j()(a,2),s=i[0],g=i[1],f=(0,b.useState)(!1),h=j()(f,2),k=h[0],F=h[1],M=(0,b.useState)(!1),N=j()(M,2),I=N[0],S=N[1],C=(0,b.useState)(!1),m=j()(C,2),x=m[0],D=m[1],L=(0,b.useState)(""),W=j()(L,2),w=W[0],P=W[1],A=(0,b.useState)(""),z=j()(A,2),c=z[0],E=z[1],y=(0,b.useRef)(),O=(0,b.useRef)(!1),H=(0,b.useState)(!1),X=j()(H,2),J=X[0],Z=X[1],Y=(0,b.useState)("manhattan"),te=j()(Y,2),U=te[0],$=te[1],ue=Ze(),ne=ue.saveYaml,V=ue.clearStorage,R=ue.checkAndPromptRestore,G=xt(y.current,s),se=G.exportDockerCompose,re=G.importDockerCompose,ie=Ct(y.current),ve=ie.isDragMode,ye=ie.togglePanningMode,xe=k||I||x,Q=bt(y.current,ye,xe),B=Q.bindShortcuts,ce=wt(y.current),de=ce.handleDoubleClick,oe=yt(y.current,s),ke=oe.contextMenu,He=oe.handleContextMenu,ze=oe.hideContextMenu,ae=oe.handleMenuItemClick,Ge=oe.showNetworkModal,be=oe.setShowNetworkModal,he=oe.currentContainerNode,T=oe.networkModalData,Ce=oe.setNetworkModalData;Et({graph:y.current,handleContextMenu:He,hideContextMenu:ze,handleDoubleClick:de});var Le=function(){R(function(t){var p=re(t);p&&(D(!1),E(""))})},Je=function(){var t=se();P(t),S(!0)},Ve=function(t){var p=typeof t=="string"?t:c,v=re(p);v&&(D(!1),E(""))},Ue=function(){if(confirm("\u786E\u5B9A\u8981\u6E05\u7A7A\u753B\u5E03\u5417\uFF1F\u6240\u6709\u672A\u4FDD\u5B58\u7684\u5185\u5BB9\u5C06\u4E22\u5931\u3002")){var t;(t=y.current)===null||t===void 0||t.clearCells(),V(),console.log("\u753B\u5E03\u5DF2\u91CD\u7F6E")}},Ne=function(){y.current&&y.current.toPNG(function(t){var p=document.createElement("a");p.download="docker-compose-diagram.png",p.href=t,p.click()},{backgroundColor:"#f5f5f5",padding:20})},Qe=function(){y.current&&y.current.toSVG(function(t){var p=document.createElement("a");p.download="docker-compose-diagram.svg",p.href=t,p.click()},{preserveDimensions:!0})},$e=function(){if(y.current){var t=y.current.toJSON(),p=JSON.stringify(t,null,2),v=new Blob([p],{type:"application/json"}),le=URL.createObjectURL(v),fe=document.createElement("a");fe.download="docker-compose-diagram.json",fe.href=le,fe.click(),URL.revokeObjectURL(le)}},pe=function(){y.current&&y.current.zoomToFit({padding:20,maxScale:1})},Oe=function(){y.current&&y.current.centerContent()},Be=function(){if(y.current){var t=y.current.zoom();t<2&&y.current.zoom(.1)}},Ke=function(){if(y.current){var t=y.current.zoom();t>.2&&y.current.zoom(-.1)}},me=function(){y.current&&y.current.zoomTo(1)},Ie=function(){if(y.current){var t=U==="manhattan"?"smooth":"manhattan";$(t);var p=y.current.getEdges();p.forEach(function(v){t==="smooth"?(v.setRouter({name:"normal"}),v.setConnector({name:"smooth"})):(v.setRouter({name:"manhattan",args:{padding:1,step:10}}),v.setConnector({name:"normal"}))})}};return(0,b.useEffect)(function(){if(!(!e.current||!u.current||!n.current)){ct();var l=e.current.clientWidth||window.innerWidth-180,t=e.current.clientHeight||window.innerHeight-125,p=kt(e.current,n.current,l,t),v=new q.kJ(p);y.current=v,B();var le=new q.e9.tb({title:"\u6D41\u7A0B\u56FE",target:v,stencilGraphWidth:200,stencilGraphHeight:180,collapsable:!0,groups:[{title:"\u57FA\u7840\u6D41\u7A0B\u56FE",name:"group1"},{title:"\u7CFB\u7EDF\u8BBE\u8BA1\u56FE",name:"group2",graphHeight:250,layoutOptions:{rowHeight:70}}],layoutOptions:{columns:2,columnWidth:80,rowHeight:55}});v.on("selection:changed",function(Re){var Mt=Re.added,_e=Re.removed,Se=v.getSelectedCells();_e.forEach(function(K){K.isEdge()&&K.removeTools()}),v.getEdges().forEach(function(K){var Fe,We,et=K.getData()||{},Wt=et.originalStroke||(((Fe=K.getTargetNode())===null||Fe===void 0?void 0:Fe.shape)==="network-router"?"#28a745":"#6c757d"),Pt=et.originalWidth||(((We=K.getTargetNode())===null||We===void 0?void 0:We.shape)==="network-router"?3:2);K.attr({line:{strokeWidth:Pt,stroke:Wt}})});var Tt=Se.filter(function(K){return K.isEdge()});if(Tt.forEach(function(K){K.attr({line:{strokeWidth:4,stroke:"#ff6b35"}}),K.addTools([{name:"vertices",args:{attrs:{fill:"#ff6b35",stroke:"#fff","stroke-width":2},snapRadius:20}},{name:"segments",args:{threshold:30,attrs:{width:24,height:10,x:-12,y:-5,rx:5,ry:5,fill:"#ff6b35",stroke:"#fff","stroke-width":2}}},{name:"source-arrowhead",args:{attrs:{fill:"#28a745",stroke:"#fff","stroke-width":3,cursor:"move",d:"M 12 -10 -12 0 12 10 Z"}}},{name:"target-arrowhead",args:{attrs:{fill:"#dc3545",stroke:"#fff","stroke-width":3,cursor:"move",d:"M -12 -10 12 0 -12 10 Z"}}},{name:"button-remove",args:{distance:30,markup:[{tagName:"circle",selector:"button",attrs:{r:10,stroke:"#dc3545","stroke-width":3,fill:"#fff",cursor:"pointer"}},{tagName:"text",textContent:"\u2715",selector:"icon",attrs:{fill:"#dc3545","font-size":14,"text-anchor":"middle","pointer-events":"none",y:"0.3em","font-weight":"bold"}}]}}])}),Se.length>0){var qe=Se.filter(function(K){return K.isNode()}),zt=Se.filter(function(K){return K.isEdge()}),Ye=Pe(Se),It=Ye.filter(function(K){return K.isNode()}),Rt=Ye.filter(function(K){return K.isEdge()});console.log("\u9009\u62E9\u53D8\u5316: \u76F4\u63A5\u9009\u4E2D ".concat(Se.length," \u4E2A\u5143\u7D20\uFF0C\u5305\u542BaddChild\u5173\u7CFB\u540E ").concat(Ye.length," \u4E2A\u5143\u7D20"),{\u76F4\u63A5\u9009\u4E2D:{\u603B\u8BA1:Se.length,\u8282\u70B9:qe.length,\u8FB9:zt.length},\u5305\u542B\u5B50\u8282\u70B9\u540E:{\u603B\u8BA1:Ye.length,\u8282\u70B9:It.length,\u8FB9:Rt.length},\u64CD\u4F5C:{\u65B0\u589E:Mt.length,\u79FB\u9664:_e.length}}),qe.forEach(function(K){var Fe=K.getChildren();Fe&&Fe.length>0&&console.log("\u8282\u70B9 ".concat(K.id," \u6709 ").concat(Fe.length," \u4E2A\u5B50\u8282\u70B9:"),Fe.map(function(We){return We.id}))})}});var fe={groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]};q.kJ.registerNode("custom-rect",{inherit:"rect",width:66,height:36,attrs:{body:{strokeWidth:1,stroke:"#5F95FF",fill:"#EFF4FF"},text:{fontSize:12,fill:"#262626"}},ports:d()({},fe)},!0),q.kJ.registerNode("custom-polygon",{inherit:"polygon",width:66,height:36,attrs:{body:{strokeWidth:1,stroke:"#5F95FF",fill:"#EFF4FF"},text:{fontSize:12,fill:"#262626"}},ports:d()(d()({},fe),{},{items:[{group:"top"},{group:"bottom"}]})},!0),q.kJ.registerNode("custom-circle",{inherit:"circle",width:45,height:45,attrs:{body:{strokeWidth:1,stroke:"#5F95FF",fill:"#EFF4FF"},text:{fontSize:12,fill:"#262626"}},ports:d()({},fe)},!0),q.kJ.registerNode("custom-image",{inherit:"rect",width:52,height:52,markup:[{tagName:"rect",selector:"body"},{tagName:"image"},{tagName:"text",selector:"label"}],attrs:{body:{stroke:"#5F95FF",fill:"#5F95FF"},image:{width:26,height:26,refX:13,refY:16},label:{refX:3,refY:2,textAnchor:"left",textVerticalAnchor:"top",fontSize:12,fill:"#fff"}},ports:d()({},fe)},!0);var we=v.createNode({shape:"custom-rect",label:"\u5F00\u59CB",attrs:{body:{rx:20,ry:26}}}),ge=v.createNode({shape:"custom-rect",label:"\u8FC7\u7A0B"}),Ee=v.createNode({shape:"custom-rect",attrs:{body:{rx:6,ry:6}},label:"\u53EF\u9009\u8FC7\u7A0B"}),je=v.createNode({shape:"custom-polygon",attrs:{body:{refPoints:"0,10 10,0 20,10 10,20"}},label:"\u51B3\u7B56"}),Dt=v.createNode({shape:"custom-polygon",attrs:{body:{refPoints:"10,0 40,0 30,20 0,20"}},label:"\u6570\u636E"}),At=v.createNode({shape:"custom-circle",label:"\u8FDE\u63A5"});le.load([we,ge,Ee,je,Dt,At],"group1");var Nt=[{label:"Client",image:"https://gw.alipayobjects.com/zos/bmw-prod/687b6cb9-4b97-42a6-96d0-34b3099133ac.svg"},{label:"Http",image:"https://gw.alipayobjects.com/zos/bmw-prod/dc1ced06-417d-466f-927b-b4a4d3265791.svg"},{label:"Api",image:"https://gw.alipayobjects.com/zos/bmw-prod/c55d7ae1-8d20-4585-bd8f-ca23653a4489.svg"},{label:"Sql",image:"https://gw.alipayobjects.com/zos/bmw-prod/6eb71764-18ed-4149-b868-53ad1542c405.svg"},{label:"Cloud",image:"https://gw.alipayobjects.com/zos/bmw-prod/c36fe7cb-dc24-4854-aeb5-88d8dc36d52e.svg"},{label:"Mq",image:"https://gw.alipayobjects.com/zos/bmw-prod/2010ac9f-40e7-49d4-8c4a-4fcf2f83033b.svg"}],Bt=Nt.map(function(Re){return v.createNode({shape:"custom-image",label:Re.label,attrs:{image:{"xlink:href":Re.image}}})});le.load(Bt,"group2");var jt=new dt(v);return g(jt),function(){document.removeEventListener("click",ze),v.dispose()}}},[]),(0,b.useEffect)(function(){y.current&&B()},[B]),(0,b.useEffect)(function(){if(s&&y.current&&!O.current){O.current=!0;var l=setTimeout(function(){Le()},100);return function(){return clearTimeout(l)}}},[s,Le]),(0,r.jsxs)("div",{className:"app",children:[(0,r.jsx)("div",{ref:u,className:"stencil-container"}),(0,r.jsx)("div",{className:"app-content",ref:e}),(0,r.jsx)("div",{ref:n,className:"minimap-container"}),(0,r.jsx)("button",{onClick:function(){return Z(!J)},style:{position:"fixed",top:"20px",right:"20px",width:"50px",height:"50px",borderRadius:"50%",backgroundColor:"#ffc107",color:"white",border:"none",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(255, 193, 7, 0.4)",transition:"all 0.3s ease",zIndex:1001},onMouseEnter:function(t){t.currentTarget.style.transform="scale(1.1)",t.currentTarget.style.backgroundColor="#e0a800"},onMouseLeave:function(t){t.currentTarget.style.transform="scale(1)",t.currentTarget.style.backgroundColor="#ffc107"},title:J?"\u5C55\u5F00\u5DE5\u5177\u680F":"\u6298\u53E0\u5DE5\u5177\u680F",children:J?"\u2630":"\u2715"}),(0,r.jsxs)("div",{style:{position:"fixed",top:"20px",right:"80px",display:J?"none":"flex",gap:"10px",zIndex:1e3},children:[(0,r.jsx)("button",{onClick:function(){return D(!0)},style:{width:"60px",height:"60px",borderRadius:"50%",backgroundColor:"#17a2b8",color:"white",border:"none",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(23, 162, 184, 0.3)",transition:"all 0.3s ease"},onMouseEnter:function(t){t.currentTarget.style.transform="scale(1.1)",t.currentTarget.style.backgroundColor="#138496"},onMouseLeave:function(t){t.currentTarget.style.transform="scale(1)",t.currentTarget.style.backgroundColor="#17a2b8"},title:"\u5BFC\u5165Docker Compose",children:"\u{1F4E4}"}),(0,r.jsx)("button",{onClick:Je,style:{width:"60px",height:"60px",borderRadius:"50%",backgroundColor:"#28a745",color:"white",border:"none",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(40, 167, 69, 0.3)",transition:"all 0.3s ease"},onMouseEnter:function(t){t.currentTarget.style.transform="scale(1.1)",t.currentTarget.style.backgroundColor="#1e7e34"},onMouseLeave:function(t){t.currentTarget.style.transform="scale(1)",t.currentTarget.style.backgroundColor="#28a745"},title:"\u5BFC\u51FADocker Compose YAML",children:"\u{1F4C1}"}),(0,r.jsx)("button",{onClick:Ne,style:{width:"60px",height:"60px",borderRadius:"50%",backgroundColor:"#6f42c1",color:"white",border:"none",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(111, 66, 193, 0.3)",transition:"all 0.3s ease"},onMouseEnter:function(t){t.currentTarget.style.transform="scale(1.1)",t.currentTarget.style.backgroundColor="#5a32a3"},onMouseLeave:function(t){t.currentTarget.style.transform="scale(1)",t.currentTarget.style.backgroundColor="#6f42c1"},title:"\u5BFC\u51FA\u4E3A PNG \u56FE\u7247",children:"\u{1F5BC}\uFE0F"}),(0,r.jsx)("button",{onClick:function(){return F(!0)},style:{width:"60px",height:"60px",borderRadius:"50%",backgroundColor:"#007bff",color:"white",border:"none",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 123, 255, 0.3)",transition:"all 0.3s ease"},onMouseEnter:function(t){t.currentTarget.style.transform="scale(1.1)",t.currentTarget.style.backgroundColor="#0056b3"},onMouseLeave:function(t){t.currentTarget.style.transform="scale(1)",t.currentTarget.style.backgroundColor="#007bff"},title:"Docker\u914D\u7F6E",children:"\u{1F433}"}),(0,r.jsx)("button",{onClick:Ue,style:{width:"60px",height:"60px",borderRadius:"50%",backgroundColor:"#dc3545",color:"white",border:"none",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(220, 53, 69, 0.3)",transition:"all 0.3s ease"},onMouseEnter:function(t){t.currentTarget.style.transform="scale(1.1)",t.currentTarget.style.backgroundColor="#c82333"},onMouseLeave:function(t){t.currentTarget.style.transform="scale(1)",t.currentTarget.style.backgroundColor="#dc3545"},title:"\u91CD\u7F6E\u753B\u5E03\uFF08\u6E05\u7A7A\u6240\u6709\u5185\u5BB9\uFF09",children:"\u{1F504}"}),(0,r.jsx)("button",{onClick:Ie,style:{width:"60px",height:"60px",borderRadius:"50%",backgroundColor:U==="manhattan"?"#fd7e14":"#20c997",color:"white",border:"none",fontSize:"24px",cursor:"pointer",boxShadow:U==="manhattan"?"0 4px 12px rgba(253, 126, 20, 0.3)":"0 4px 12px rgba(32, 201, 151, 0.3)",transition:"all 0.3s ease"},onMouseEnter:function(t){t.currentTarget.style.transform="scale(1.1)",t.currentTarget.style.backgroundColor=U==="manhattan"?"#e8590c":"#1aa179"},onMouseLeave:function(t){t.currentTarget.style.transform="scale(1)",t.currentTarget.style.backgroundColor=U==="manhattan"?"#fd7e14":"#20c997"},title:U==="manhattan"?"\u5207\u6362\u5230\u66F2\u7EBF":"\u5207\u6362\u5230\u76F4\u89D2\u8FDE\u7EBF",children:U==="manhattan"?"\u{1F4D0}":"\u3030\uFE0F"})]}),(0,r.jsxs)("div",{style:{position:"fixed",top:"100px",right:"80px",display:J?"none":"flex",gap:"10px",zIndex:1e3},children:[(0,r.jsx)("button",{onClick:Be,style:{width:"50px",height:"50px",borderRadius:"50%",backgroundColor:"#6c757d",color:"white",border:"none",fontSize:"20px",cursor:"pointer",boxShadow:"0 2px 8px rgba(108, 117, 125, 0.3)",transition:"all 0.3s ease"},onMouseEnter:function(t){t.currentTarget.style.transform="scale(1.1)",t.currentTarget.style.backgroundColor="#5a6268"},onMouseLeave:function(t){t.currentTarget.style.transform="scale(1)",t.currentTarget.style.backgroundColor="#6c757d"},title:"\u653E\u5927",children:"\u2795"}),(0,r.jsx)("button",{onClick:Ke,style:{width:"50px",height:"50px",borderRadius:"50%",backgroundColor:"#6c757d",color:"white",border:"none",fontSize:"20px",cursor:"pointer",boxShadow:"0 2px 8px rgba(108, 117, 125, 0.3)",transition:"all 0.3s ease"},onMouseEnter:function(t){t.currentTarget.style.transform="scale(1.1)",t.currentTarget.style.backgroundColor="#5a6268"},onMouseLeave:function(t){t.currentTarget.style.transform="scale(1)",t.currentTarget.style.backgroundColor="#6c757d"},title:"\u7F29\u5C0F",children:"\u2796"}),(0,r.jsx)("button",{onClick:me,style:{width:"50px",height:"50px",borderRadius:"50%",backgroundColor:"#6c757d",color:"white",border:"none",fontSize:"16px",cursor:"pointer",boxShadow:"0 2px 8px rgba(108, 117, 125, 0.3)",transition:"all 0.3s ease"},onMouseEnter:function(t){t.currentTarget.style.transform="scale(1.1)",t.currentTarget.style.backgroundColor="#5a6268"},onMouseLeave:function(t){t.currentTarget.style.transform="scale(1)",t.currentTarget.style.backgroundColor="#6c757d"},title:"\u91CD\u7F6E\u7F29\u653E (100%)",children:"1:1"}),(0,r.jsx)("button",{onClick:pe,style:{width:"50px",height:"50px",borderRadius:"50%",backgroundColor:"#6c757d",color:"white",border:"none",fontSize:"20px",cursor:"pointer",boxShadow:"0 2px 8px rgba(108, 117, 125, 0.3)",transition:"all 0.3s ease"},onMouseEnter:function(t){t.currentTarget.style.transform="scale(1.1)",t.currentTarget.style.backgroundColor="#5a6268"},onMouseLeave:function(t){t.currentTarget.style.transform="scale(1)",t.currentTarget.style.backgroundColor="#6c757d"},title:"\u7F29\u653E\u5230\u5408\u9002\u5927\u5C0F",children:"\u{1F50D}"}),(0,r.jsx)("button",{onClick:Oe,style:{width:"50px",height:"50px",borderRadius:"50%",backgroundColor:"#6c757d",color:"white",border:"none",fontSize:"20px",cursor:"pointer",boxShadow:"0 2px 8px rgba(108, 117, 125, 0.3)",transition:"all 0.3s ease"},onMouseEnter:function(t){t.currentTarget.style.transform="scale(1.1)",t.currentTarget.style.backgroundColor="#5a6268"},onMouseLeave:function(t){t.currentTarget.style.transform="scale(1)",t.currentTarget.style.backgroundColor="#6c757d"},title:"\u5C45\u4E2D\u663E\u793A",children:"\u{1F3AF}"})]}),k&&(0,r.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001},children:(0,r.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"8px",width:"600px",maxWidth:"90vw",maxHeight:"90vh",overflowY:"auto",padding:"20px",position:"relative"},children:[(0,r.jsx)("button",{onClick:function(){return F(!1)},style:{position:"absolute",top:"10px",right:"10px",background:"none",border:"none",fontSize:"24px",cursor:"pointer",color:"#666"},children:"\xD7"}),s?(0,r.jsx)(ft,{dockerFactory:s,onClose:function(){return F(!1)}}):(0,r.jsx)("div",{style:{color:"#666",textAlign:"center",padding:"50px"},children:"\u6B63\u5728\u521D\u59CB\u5316..."})]})}),I&&(0,r.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001},children:(0,r.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"8px",width:"800px",maxWidth:"90vw",maxHeight:"90vh",overflowY:"auto",padding:"20px",position:"relative"},children:[(0,r.jsx)("button",{onClick:function(){return S(!1)},style:{position:"absolute",top:"10px",right:"10px",background:"none",border:"none",fontSize:"24px",cursor:"pointer",color:"#666"},children:"\xD7"}),(0,r.jsx)("h2",{style:{margin:"0 0 20px 0",color:"#333"},children:"\u{1F4C1} \u5BFC\u51FA Docker Compose"}),(0,r.jsxs)("div",{style:{marginBottom:"20px",display:"flex",gap:"10px"},children:[(0,r.jsx)("button",{onClick:function(){navigator.clipboard.writeText(w),console.log("\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F")},style:{padding:"8px 16px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"\u{1F4CB} \u590D\u5236\u5230\u526A\u8D34\u677F"}),(0,r.jsx)("button",{onClick:function(){var t=new Blob([w],{type:"text/yaml"}),p=URL.createObjectURL(t),v=document.createElement("a");v.href=p,v.download="docker-compose.yml",v.click(),URL.revokeObjectURL(p)},style:{padding:"8px 16px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"\u{1F4BE} \u4E0B\u8F7D\u6587\u4EF6"})]}),(0,r.jsx)("div",{style:{backgroundColor:"#f8f9fa",border:"1px solid #e9ecef",borderRadius:"4px",padding:"15px",fontFamily:'Monaco, Consolas, "Courier New", monospace',fontSize:"14px",lineHeight:"1.5",whiteSpace:"pre-wrap",wordBreak:"break-all",maxHeight:"500px",overflow:"auto",color:"#333"},children:w})]})}),x&&(0,r.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001},children:(0,r.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"8px",width:"800px",maxWidth:"90vw",maxHeight:"90vh",overflowY:"auto",padding:"20px",position:"relative"},children:[(0,r.jsx)("button",{onClick:function(){D(!1),E("")},style:{position:"absolute",top:"10px",right:"10px",background:"none",border:"none",fontSize:"24px",cursor:"pointer",color:"#666"},children:"\xD7"}),(0,r.jsx)("h2",{style:{margin:"0 0 20px 0",color:"#333"},children:"\u{1F4E4} \u5BFC\u5165 Docker Compose"}),(0,r.jsx)("p",{style:{color:"#666",marginBottom:"15px"},children:"\u8BF7\u7C98\u8D34\u60A8\u7684 docker-compose.yml \u5185\u5BB9\u5230\u4E0B\u65B9\u6587\u672C\u6846\u4E2D\uFF0C\u7136\u540E\u70B9\u51FB\u5BFC\u5165\u6309\u94AE\u3002"}),(0,r.jsxs)("div",{style:{marginBottom:"15px",display:"flex",gap:"10px",alignItems:"center"},children:[(0,r.jsx)("button",{onClick:function(){var t=`version: "3.8"
services:
  redis-master:
    image: redis:7-alpine
    command: redis-server --port 6379
    ports:
      - "6379:6379"
    volumes:
      - redis-master-data:/data
    networks:
      redis-cluster:
        ipv4_address: 172.20.0.10
    restart: unless-stopped

  redis-slave-1:
    image: redis:7-alpine
    command: redis-server --port 6380 --replicaof redis-master 6379
    ports:
      - "6380:6380"
    volumes:
      - redis-slave1-data:/data
    networks:
      redis-cluster:
        ipv4_address: 172.20.0.11
    depends_on:
      - redis-master
    restart: unless-stopped

  redis-slave-2:
    image: redis:7-alpine
    command: redis-server --port 6381 --replicaof redis-master 6379
    ports:
      - "6381:6381"
    volumes:
      - redis-slave2-data:/data
    networks:
      redis-cluster:
        ipv4_address: 172.20.0.12
    depends_on:
      - redis-master
    restart: unless-stopped

networks:
  redis-cluster:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16
          gateway: 172.20.0.1

volumes:
  redis-master-data:
  redis-slave1-data:
  redis-slave2-data:`;E(t)},style:{padding:"6px 12px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"\u{1F4DD} \u4F7F\u7528 Redis \u96C6\u7FA4\u793A\u4F8B"}),(0,r.jsx)("span",{style:{fontSize:"12px",color:"#999"},children:"\u70B9\u51FB\u540E\u4F1A\u586B\u5165\u4E00\u4E2A\u5B8C\u6574\u7684 Redis \u4E3B\u4ECE\u914D\u7F6E\u793A\u4F8B"})]}),(0,r.jsx)("textarea",{value:c,onChange:function(t){return E(t.target.value)},placeholder:"\u8BF7\u5728\u6B64\u5904\u7C98\u8D34 docker-compose.yml \u5185\u5BB9...",style:{width:"100%",height:"400px",padding:"15px",border:"1px solid #e9ecef",borderRadius:"4px",fontFamily:'Monaco, Consolas, "Courier New", monospace',fontSize:"14px",lineHeight:"1.5",resize:"vertical",outline:"none",marginBottom:"20px"}}),(0,r.jsxs)("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:[(0,r.jsx)("button",{onClick:function(){D(!1),E("")},style:{padding:"8px 16px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"\u53D6\u6D88"}),(0,r.jsx)("button",{onClick:Ve,disabled:!c.trim(),style:{padding:"8px 16px",backgroundColor:c.trim()?"#17a2b8":"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:c.trim()?"pointer":"not-allowed"},children:"\u{1F680} \u5BFC\u5165"})]}),(0,r.jsxs)("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#f8f9fa",borderRadius:"4px",fontSize:"12px",color:"#666"},children:[(0,r.jsx)("strong",{children:"\u2728 \u667A\u80FD\u5BFC\u5165\u529F\u80FD\uFF1A"}),(0,r.jsxs)("ul",{style:{margin:"8px 0",paddingLeft:"20px"},children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"\u670D\u52A1\u67B6\u6784\uFF1A"})," \u81EA\u52A8\u521B\u5EFA\u5BB9\u5668\u8282\u70B9\uFF0C\u6E05\u6670\u5C55\u793A\u670D\u52A1\u540D\u3001\u955C\u50CF\u3001\u547D\u4EE4"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"\u7AEF\u53E3\u6620\u5C04\uFF1A"})," \u53EF\u89C6\u5316\u663E\u793A\u7AEF\u53E3\u914D\u7F6E\uFF0C\u652F\u6301\u591A\u7AEF\u53E3"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"\u5377\u6302\u8F7D\uFF1A"})," \u76F4\u89C2\u5C55\u793A\u6570\u636E\u5377\u6302\u8F7D\u5173\u7CFB"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"\u7F51\u7EDC\u62D3\u6251\uFF1A"})," \u81EA\u52A8\u521B\u5EFA\u4EA4\u6362\u673A\uFF0C\u5C55\u793A\u7F51\u7EDC\u8FDE\u63A5\u7ED3\u6784"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"\u667A\u80FD\u5E03\u5C40\uFF1A"})," \u81EA\u52A8\u6392\u5217\u5BB9\u5668\uFF0C\u907F\u514D\u91CD\u53E0\uFF0C\u652F\u6301\u4F9D\u8D56\u5173\u7CFB"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"\u914D\u7F6E\u5B8C\u6574\uFF1A"})," \u5305\u542B\u73AF\u5883\u53D8\u91CF\u3001\u91CD\u542F\u7B56\u7565\u3001\u542F\u52A8\u547D\u4EE4\u7B49"]})]}),(0,r.jsxs)("div",{style:{marginTop:"10px",padding:"8px",backgroundColor:"#e8f5e8",borderRadius:"3px"},children:["\u{1F4A1} ",(0,r.jsx)("strong",{children:"\u63D0\u793A\uFF1A"})," \u5BFC\u5165\u540E\u53EF\u5728\u753B\u5E03\u4E0A\u624B\u52A8\u8C03\u6574\u5E03\u5C40\uFF0C\u8FDE\u63A5\u7F51\u7EDC\u63A5\u53E3\u5230\u4EA4\u6362\u673A"]})]})]})}),Ge&&(0,r.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001},children:(0,r.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"8px",width:"500px",maxWidth:"90vw",padding:"20px",position:"relative"},children:[(0,r.jsx)("button",{onClick:function(){return be(!1)},style:{position:"absolute",top:"10px",right:"10px",background:"none",border:"none",fontSize:"24px",cursor:"pointer",color:"#666"},children:"\xD7"}),(0,r.jsx)("h2",{style:{margin:"0 0 20px 0",color:"#333"},children:"\u{1F310} \u6DFB\u52A0\u7F51\u7EDC\u63A5\u53E3"}),(0,r.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"\u63A5\u53E3\u540D\u79F0\uFF1A"}),(0,r.jsx)("input",{type:"text",value:T.interfaceName,onChange:function(t){return Ce(function(p){return d()(d()({},p),{},{interfaceName:t.target.value})})},placeholder:"\u4F8B\u5982: eth0, eth1",style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px"}})]}),(0,r.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"\u8FDE\u63A5\u5230\u4EA4\u6362\u673A\uFF1A"}),(0,r.jsxs)("select",{value:T.switchName,onChange:function(t){return Ce(function(p){return d()(d()({},p),{},{switchName:t.target.value})})},style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px"},children:[(0,r.jsx)("option",{value:"",children:"\u8BF7\u9009\u62E9\u4EA4\u6362\u673A"}),(o=y.current)===null||o===void 0?void 0:o.getNodes().filter(function(l){return l.shape==="network-switch"}).map(function(l){var t=l.getData()||{},p=l.attr("text/text"),v=t.switchName||(typeof p=="string"?p.split(`
`)[0]:"switch");return(0,r.jsx)("option",{value:v,children:v},l.id)}),(0,r.jsx)("option",{value:"new-switch",children:"+ \u521B\u5EFA\u65B0\u4EA4\u6362\u673A"})]})]}),T.switchName==="new-switch"&&(0,r.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"\u65B0\u4EA4\u6362\u673A\u540D\u79F0\uFF1A"}),(0,r.jsx)("input",{type:"text",placeholder:"\u4F8B\u5982: switch1, redis-net",onChange:function(t){return Ce(function(p){return d()(d()({},p),{},{switchName:t.target.value})})},style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px"}})]}),(0,r.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"IP\u914D\u7F6E\uFF1A"}),(0,r.jsxs)("div",{style:{display:"flex",gap:"15px",alignItems:"center"},children:[(0,r.jsxs)("label",{style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[(0,r.jsx)("input",{type:"radio",name:"ipConfig",value:"dynamic",checked:T.ipConfig==="dynamic",onChange:function(t){return Ce(function(p){return d()(d()({},p),{},{ipConfig:t.target.value,staticIP:""})})},style:{marginRight:"5px"}}),"\u52A8\u6001\u5206\u914D (DHCP)"]}),(0,r.jsxs)("label",{style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[(0,r.jsx)("input",{type:"radio",name:"ipConfig",value:"static",checked:T.ipConfig==="static",onChange:function(t){return Ce(function(p){return d()(d()({},p),{},{ipConfig:t.target.value})})},style:{marginRight:"5px"}}),"\u9759\u6001IP"]})]})]}),T.ipConfig==="static"&&(0,r.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"\u9759\u6001IP\u5730\u5740\uFF1A"}),(0,r.jsx)("input",{type:"text",value:T.staticIP,onChange:function(t){return Ce(function(p){return d()(d()({},p),{},{staticIP:t.target.value})})},placeholder:"\u4F8B\u5982: 172.20.0.100",style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px"}})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:[(0,r.jsx)("button",{onClick:function(){return be(!1)},style:{padding:"8px 16px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"\u53D6\u6D88"}),(0,r.jsx)("button",{onClick:function(){if(!T.interfaceName.trim()){alert("\u8BF7\u8F93\u5165\u63A5\u53E3\u540D\u79F0");return}if(!T.switchName.trim()){alert("\u8BF7\u9009\u62E9\u6216\u8F93\u5165\u4EA4\u6362\u673A\u540D\u79F0");return}if(T.ipConfig==="static"&&!T.staticIP.trim()){alert("\u8BF7\u8F93\u5165\u9759\u6001IP\u5730\u5740");return}var t=(he==null?void 0:he.getChildren())||[],p=t.filter(function(we){return we.shape==="docker-network"}).map(function(we){var ge,Ee,je=we.getData()||{};return((ge=je.networkInterface)===null||ge===void 0?void 0:ge.interfaceName)||((Ee=we.attr("text/text"))===null||Ee===void 0?void 0:Ee.split(`
`)[0])||""});if(p.includes(T.interfaceName)){alert('\u63A5\u53E3\u540D "'.concat(T.interfaceName,'" \u5DF2\u5B58\u5728\uFF0C\u8BF7\u4F7F\u7528\u5176\u4ED6\u540D\u79F0'));return}if(s&&he){var v=s.addNetworkToContainer(he,T.interfaceName,T.switchName),le={interfaceName:T.interfaceName,switchName:T.switchName,ipConfig:T.ipConfig,staticIP:T.ipConfig==="static"?T.staticIP:void 0};v.setData({networkInterface:le,isConnected:!1});var fe=T.ipConfig==="static"&&T.staticIP?"".concat(T.interfaceName,`
`).concat(T.staticIP):"".concat(T.interfaceName,`
dynamic`);v.attr("text/text",fe),setTimeout(function(){s.manualConnectNetworkToSwitch&&s.manualConnectNetworkToSwitch(v.id,T.switchName)},100),console.log("\u6DFB\u52A0\u7F51\u7EDC\u63A5\u53E3: ".concat(T.interfaceName," -> ").concat(T.switchName))}be(!1)},disabled:!T.interfaceName.trim()||!T.switchName.trim(),style:{padding:"8px 16px",backgroundColor:!T.interfaceName.trim()||!T.switchName.trim()?"#6c757d":"#28a745",color:"white",border:"none",borderRadius:"4px",cursor:!T.interfaceName.trim()||!T.switchName.trim()?"not-allowed":"pointer"},children:"\u{1F680} \u521B\u5EFA\u7F51\u7EDC\u63A5\u53E3"})]})]})}),ke.visible&&(0,r.jsxs)("div",{style:{position:"fixed",left:ke.x,top:ke.y,backgroundColor:"white",border:"1px solid #ccc",borderRadius:"4px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)",zIndex:1e3,minWidth:"150px"},children:[ke.nodeType==="container"&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{style:{padding:"8px 12px",cursor:"pointer",fontSize:"14px",borderBottom:"1px solid #f0f0f0"},onClick:function(){return ae("add-port")},onMouseEnter:function(t){return t.currentTarget.style.backgroundColor="#f5f5f5"},onMouseLeave:function(t){return t.currentTarget.style.backgroundColor="white"},children:"\u{1F50C} \u6DFB\u52A0\u7AEF\u53E3"}),(0,r.jsx)("div",{style:{padding:"8px 12px",cursor:"pointer",fontSize:"14px",borderBottom:"1px solid #f0f0f0"},onClick:function(){return ae("add-volume")},onMouseEnter:function(t){return t.currentTarget.style.backgroundColor="#f5f5f5"},onMouseLeave:function(t){return t.currentTarget.style.backgroundColor="white"},children:"\u{1F4BE} \u6DFB\u52A0\u5377"}),(0,r.jsx)("div",{style:{padding:"8px 12px",cursor:"pointer",fontSize:"14px",borderBottom:"1px solid #f0f0f0"},onClick:function(){return ae("add-network")},onMouseEnter:function(t){return t.currentTarget.style.backgroundColor="#f5f5f5"},onMouseLeave:function(t){return t.currentTarget.style.backgroundColor="white"},children:"\u{1F310} \u6DFB\u52A0\u7F51\u7EDC"}),(0,r.jsx)("div",{style:{padding:"8px 12px",cursor:"pointer",fontSize:"14px"},onClick:function(){return ae("add-user")},onMouseEnter:function(t){return t.currentTarget.style.backgroundColor="#f5f5f5"},onMouseLeave:function(t){return t.currentTarget.style.backgroundColor="white"},children:"\u{1F464} \u6DFB\u52A0\u7528\u6237"})]}),ke.nodeType==="component"&&(0,r.jsx)("div",{style:{padding:"8px 12px",cursor:"pointer",fontSize:"14px",color:"#ff4d4f"},onClick:function(){return ae("delete-component")},onMouseEnter:function(t){return t.currentTarget.style.backgroundColor="#fff2f0"},onMouseLeave:function(t){return t.currentTarget.style.backgroundColor="white"},children:"\u{1F5D1}\uFE0F \u5220\u9664\u7EC4\u4EF6"})]})]})},St=Ft}}]);
